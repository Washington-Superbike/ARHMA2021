\hypertarget{_data_logging_8ino_source}{}\doxysection{Data\+Logging.\+ino}
\mbox{\hyperlink{_data_logging_8ino}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{\Hypertarget{_data_logging_8ino_source_l00001}00001 }
\DoxyCodeLine{\Hypertarget{_data_logging_8ino_source_l00027}00027 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{_data_logging_8h}{DataLogging.h}}"{}}}
\DoxyCodeLine{\Hypertarget{_data_logging_8ino_source_l00028}00028 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{_display_8h}{Display.h}}"{}}}
\DoxyCodeLine{\Hypertarget{_data_logging_8ino_source_l00029}00029 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{_main_8h}{Main.h}}"{}}}
\DoxyCodeLine{\Hypertarget{_data_logging_8ino_source_l00030}00030 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{_free_r_t_o_s___t_e_e_n_s_y4_8h}{FreeRTOS\_TEENSY4.h}}"{}}}
\DoxyCodeLine{\Hypertarget{_data_logging_8ino_source_l00031}00031 }
\DoxyCodeLine{\Hypertarget{_data_logging_8ino_source_l00032}00032 \textcolor{comment}{//dataLoggingTask processes all of the data logs and formats each CSV file output}}
\DoxyCodeLine{\Hypertarget{_data_logging_8ino_source_l00033}\mbox{\hyperlink{_data_logging_8h_a24f7ab7e53619e5770ad9acc25b9b819}{00033}} \textcolor{keywordtype}{void} \mbox{\hyperlink{_data_logging_8ino_a24f7ab7e53619e5770ad9acc25b9b819}{dataLoggingTask}}(\textcolor{keywordtype}{void} *dlData) \{}
\DoxyCodeLine{\Hypertarget{_data_logging_8ino_source_l00034}00034   \mbox{\hyperlink{struct_data_logging_task_data}{DataLoggingTaskData}} dl = *(\mbox{\hyperlink{struct_data_logging_task_data}{DataLoggingTaskData}} *)dlData;}
\DoxyCodeLine{\Hypertarget{_data_logging_8ino_source_l00035}00035   \textcolor{keywordtype}{int} sTime;}
\DoxyCodeLine{\Hypertarget{_data_logging_8ino_source_l00036}00036   \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} lastSave = millis();}
\DoxyCodeLine{\Hypertarget{_data_logging_8ino_source_l00037}00037   \textcolor{keywordflow}{while} (1) \{}
\DoxyCodeLine{\Hypertarget{_data_logging_8ino_source_l00038}00038     \textcolor{keywordtype}{int} mTime = millis();}
\DoxyCodeLine{\Hypertarget{_data_logging_8ino_source_l00039}00039     sTime = (millis() -\/ \mbox{\hyperlink{_data_logging_8h_a90b197693eeaad244ff381d5645b1c16}{epochTime}}) / 1000;}
\DoxyCodeLine{\Hypertarget{_data_logging_8ino_source_l00040}00040     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < dl.\mbox{\hyperlink{struct_data_logging_task_data_a7ae4a326c6a1c95c14fb7a3d64fbb36e}{writersLen}}; i++) \{}
\DoxyCodeLine{\Hypertarget{_data_logging_8ino_source_l00041}00041       \mbox{\hyperlink{_data_logging_8ino_aa394fd0868d0e097f701cb3f21d9c451}{addRecord}}(dl.\mbox{\hyperlink{struct_data_logging_task_data_a8749861675b46b70c4cb68262d220e2a}{writers}}[i], sTime);}
\DoxyCodeLine{\Hypertarget{_data_logging_8ino_source_l00042}00042     \}}
\DoxyCodeLine{\Hypertarget{_data_logging_8ino_source_l00043}00043     \textcolor{keywordflow}{if} ((millis() -\/ lastSave) > 10000) \{}
\DoxyCodeLine{\Hypertarget{_data_logging_8ino_source_l00044}00044       Serial.print(\textcolor{stringliteral}{"{}Saving files..."{}});}
\DoxyCodeLine{\Hypertarget{_data_logging_8ino_source_l00045}00045       \mbox{\hyperlink{_data_logging_8ino_a52d8bf385131a3543793f22ee432100a}{saveFiles}}(dl.\mbox{\hyperlink{struct_data_logging_task_data_a8749861675b46b70c4cb68262d220e2a}{writers}}, dl.\mbox{\hyperlink{struct_data_logging_task_data_a7ae4a326c6a1c95c14fb7a3d64fbb36e}{writersLen}});}
\DoxyCodeLine{\Hypertarget{_data_logging_8ino_source_l00046}00046       Serial.println(\textcolor{stringliteral}{"{}saved"{}});}
\DoxyCodeLine{\Hypertarget{_data_logging_8ino_source_l00047}00047       lastSave = millis();}
\DoxyCodeLine{\Hypertarget{_data_logging_8ino_source_l00048}00048     \}}
\DoxyCodeLine{\Hypertarget{_data_logging_8ino_source_l00049}00049     \textcolor{comment}{// delay 50ms (change to modify how fast records are saved}}
\DoxyCodeLine{\Hypertarget{_data_logging_8ino_source_l00050}00050     \textcolor{comment}{// in the future, this 'writeRate' could be specific to each data log}}
\DoxyCodeLine{\Hypertarget{_data_logging_8ino_source_l00051}00051     \textcolor{comment}{// ex: motor current should write every 5ms but battery voltage only every 1 second}}
\DoxyCodeLine{\Hypertarget{_data_logging_8ino_source_l00052}00052     \textcolor{comment}{// as battery voltage doesn't change very fast but current can}}
\DoxyCodeLine{\Hypertarget{_data_logging_8ino_source_l00053}00053     \mbox{\hyperlink{task_8h_aa154068cecd7f31446a7a84af44ab1a3}{vTaskDelay}}((50 * \mbox{\hyperlink{_free_r_t_o_s_config__default_8h_a2f0258dd1e3b877e5bc013be54c2db6a}{configTICK\_RATE\_HZ}}) / 1000);}
\DoxyCodeLine{\Hypertarget{_data_logging_8ino_source_l00054}00054   \}}
\DoxyCodeLine{\Hypertarget{_data_logging_8ino_source_l00055}00055 \}}
\DoxyCodeLine{\Hypertarget{_data_logging_8ino_source_l00056}00056 }
\DoxyCodeLine{\Hypertarget{_data_logging_8ino_source_l00057}00057 \textcolor{comment}{//startSD attempts to begin communication with the SD card on SPI (single bit bus)}}
\DoxyCodeLine{\Hypertarget{_data_logging_8ino_source_l00058}00058 \textcolor{comment}{//Returns true if no errors exist, returns false if an error exists}}
\DoxyCodeLine{\Hypertarget{_data_logging_8ino_source_l00059}\mbox{\hyperlink{_data_logging_8h_a0d2a3a213399ec010b89dede4ba4de77}{00059}} \textcolor{keywordtype}{bool} \mbox{\hyperlink{_data_logging_8ino_a0d2a3a213399ec010b89dede4ba4de77}{startSD}}() \{}
\DoxyCodeLine{\Hypertarget{_data_logging_8ino_source_l00060}00060   \textcolor{keywordflow}{return}  \mbox{\hyperlink{_data_logging_8h_a15e6b7e1f0fb2d1e0fe1654721bb5302}{sd}}.begin(SdioConfig(FIFO\_SDIO));}
\DoxyCodeLine{\Hypertarget{_data_logging_8ino_source_l00061}00061 \}}
\DoxyCodeLine{\Hypertarget{_data_logging_8ino_source_l00062}00062 }
\DoxyCodeLine{\Hypertarget{_data_logging_8ino_source_l00063}00063 \textcolor{comment}{//openFile attemps to open the file designated at the filename inside CSVWriter}}
\DoxyCodeLine{\Hypertarget{_data_logging_8ino_source_l00064}00064 \textcolor{comment}{//Returns true if no errors, returns false if any error exists}}
\DoxyCodeLine{\Hypertarget{_data_logging_8ino_source_l00065}\mbox{\hyperlink{_data_logging_8h_ac579da51eca1f113da5d315ab23b8b1e}{00065}} \textcolor{keywordtype}{bool} \mbox{\hyperlink{_data_logging_8ino_ac579da51eca1f113da5d315ab23b8b1e}{openFile}}(\mbox{\hyperlink{struct_c_s_v_writer}{CSVWriter}} *writer) \{}
\DoxyCodeLine{\Hypertarget{_data_logging_8ino_source_l00066}00066   writer-\/>\mbox{\hyperlink{struct_c_s_v_writer_a84e1fe8c16267fb15806b9024353b962}{open}} = writer-\/>\mbox{\hyperlink{struct_c_s_v_writer_a134410cbaf84e674a0f3eb1465c37eaa}{file}}.open(writer-\/>\mbox{\hyperlink{struct_c_s_v_writer_a683c9f4868ac2665b4eb34773d1445cf}{filename}}, O\_RDWR | O\_CREAT);}
\DoxyCodeLine{\Hypertarget{_data_logging_8ino_source_l00067}00067   \textcolor{keywordflow}{return} writer-\/>\mbox{\hyperlink{struct_c_s_v_writer_a84e1fe8c16267fb15806b9024353b962}{open}};}
\DoxyCodeLine{\Hypertarget{_data_logging_8ino_source_l00068}00068 \}}
\DoxyCodeLine{\Hypertarget{_data_logging_8ino_source_l00069}00069 }
\DoxyCodeLine{\Hypertarget{_data_logging_8ino_source_l00070}00070 \textcolor{comment}{//closeFile closes the file inside the CSVWriter}}
\DoxyCodeLine{\Hypertarget{_data_logging_8ino_source_l00071}\mbox{\hyperlink{_data_logging_8h_a10c88f7cc0c34cd0a584f78997f13827}{00071}} \textcolor{keywordtype}{void} \mbox{\hyperlink{_data_logging_8ino_a10c88f7cc0c34cd0a584f78997f13827}{closeFile}}(\mbox{\hyperlink{struct_c_s_v_writer}{CSVWriter}} *writer) \{}
\DoxyCodeLine{\Hypertarget{_data_logging_8ino_source_l00072}00072   writer-\/>\mbox{\hyperlink{struct_c_s_v_writer_a134410cbaf84e674a0f3eb1465c37eaa}{file}}.close();}
\DoxyCodeLine{\Hypertarget{_data_logging_8ino_source_l00073}00073 \}}
\DoxyCodeLine{\Hypertarget{_data_logging_8ino_source_l00074}00074 }
\DoxyCodeLine{\Hypertarget{_data_logging_8ino_source_l00075}\mbox{\hyperlink{_data_logging_8h_a678245415389e1bbd75b088a980b008a}{00075}} \textcolor{keywordtype}{void} \mbox{\hyperlink{_data_logging_8ino_a678245415389e1bbd75b088a980b008a}{saveFile}}(\mbox{\hyperlink{struct_c_s_v_writer}{CSVWriter}} *writer) \{}
\DoxyCodeLine{\Hypertarget{_data_logging_8ino_source_l00076}00076   writer-\/>\mbox{\hyperlink{struct_c_s_v_writer_a134410cbaf84e674a0f3eb1465c37eaa}{file}}.sync();}
\DoxyCodeLine{\Hypertarget{_data_logging_8ino_source_l00077}00077 \}}
\DoxyCodeLine{\Hypertarget{_data_logging_8ino_source_l00078}00078 }
\DoxyCodeLine{\Hypertarget{_data_logging_8ino_source_l00079}\mbox{\hyperlink{_data_logging_8h_a52d8bf385131a3543793f22ee432100a}{00079}} \textcolor{keywordtype}{void} \mbox{\hyperlink{_data_logging_8ino_a52d8bf385131a3543793f22ee432100a}{saveFiles}}(\mbox{\hyperlink{struct_c_s_v_writer}{CSVWriter}} **writers, \textcolor{keywordtype}{int} writersLen) \{}
\DoxyCodeLine{\Hypertarget{_data_logging_8ino_source_l00080}00080   \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < writersLen; i++) \{}
\DoxyCodeLine{\Hypertarget{_data_logging_8ino_source_l00081}00081     \mbox{\hyperlink{_data_logging_8ino_a678245415389e1bbd75b088a980b008a}{saveFile}}(writers[i]);}
\DoxyCodeLine{\Hypertarget{_data_logging_8ino_source_l00082}00082   \}}
\DoxyCodeLine{\Hypertarget{_data_logging_8ino_source_l00083}00083 \}}
\DoxyCodeLine{\Hypertarget{_data_logging_8ino_source_l00084}00084 }
\DoxyCodeLine{\Hypertarget{_data_logging_8ino_source_l00085}\mbox{\hyperlink{_data_logging_8h_a8777416fb5b01666e7b28ada9f3b552a}{00085}} \textcolor{keywordtype}{void} \mbox{\hyperlink{_data_logging_8ino_a8777416fb5b01666e7b28ada9f3b552a}{printFile}}(\mbox{\hyperlink{struct_c_s_v_writer}{CSVWriter}} *writer) \{}
\DoxyCodeLine{\Hypertarget{_data_logging_8ino_source_l00086}00086   \textcolor{keywordflow}{if} (!writer-\/>\mbox{\hyperlink{struct_c_s_v_writer_a84e1fe8c16267fb15806b9024353b962}{open}}) \{}
\DoxyCodeLine{\Hypertarget{_data_logging_8ino_source_l00087}00087     \mbox{\hyperlink{_data_logging_8ino_ac579da51eca1f113da5d315ab23b8b1e}{openFile}}(writer);}
\DoxyCodeLine{\Hypertarget{_data_logging_8ino_source_l00088}00088   \}}
\DoxyCodeLine{\Hypertarget{_data_logging_8ino_source_l00089}00089   \textcolor{keywordtype}{int} data;}
\DoxyCodeLine{\Hypertarget{_data_logging_8ino_source_l00090}00090   \textcolor{keywordflow}{while} ((data = writer-\/>\mbox{\hyperlink{struct_c_s_v_writer_a134410cbaf84e674a0f3eb1465c37eaa}{file}}.read()) >= 0) Serial.write(data);}
\DoxyCodeLine{\Hypertarget{_data_logging_8ino_source_l00091}00091 \}}
\DoxyCodeLine{\Hypertarget{_data_logging_8ino_source_l00092}00092 }
\DoxyCodeLine{\Hypertarget{_data_logging_8ino_source_l00093}00093 \textcolor{comment}{//addRecord adds a record to the data log with the included time in seconds since the recording has started}}
\DoxyCodeLine{\Hypertarget{_data_logging_8ino_source_l00094}00094 \textcolor{comment}{//the data comes from the dataIn member (shared variable to other tasks)}}
\DoxyCodeLine{\Hypertarget{_data_logging_8ino_source_l00095}\mbox{\hyperlink{_data_logging_8h_aa394fd0868d0e097f701cb3f21d9c451}{00095}} \textcolor{keywordtype}{void} \mbox{\hyperlink{_data_logging_8ino_aa394fd0868d0e097f701cb3f21d9c451}{addRecord}}(\mbox{\hyperlink{struct_c_s_v_writer}{CSVWriter}} *writer, \textcolor{keywordtype}{int} sTime) \{}
\DoxyCodeLine{\Hypertarget{_data_logging_8ino_source_l00096}00096   \textcolor{keywordflow}{if} (!writer-\/>\mbox{\hyperlink{struct_c_s_v_writer_a84e1fe8c16267fb15806b9024353b962}{open}}) \{}
\DoxyCodeLine{\Hypertarget{_data_logging_8ino_source_l00097}00097     \mbox{\hyperlink{_data_logging_8ino_ac579da51eca1f113da5d315ab23b8b1e}{openFile}}(writer);}
\DoxyCodeLine{\Hypertarget{_data_logging_8ino_source_l00098}00098   \}}
\DoxyCodeLine{\Hypertarget{_data_logging_8ino_source_l00099}00099 }
\DoxyCodeLine{\Hypertarget{_data_logging_8ino_source_l00100}00100   \textcolor{comment}{// the function kinda works but should be redone later to use (void *) datatype instead of (float *).}}
\DoxyCodeLine{\Hypertarget{_data_logging_8ino_source_l00101}00101   \textcolor{comment}{// then cast the (void *) to whatever datatype is given by D\_TYPE}}
\DoxyCodeLine{\Hypertarget{_data_logging_8ino_source_l00102}00102   \textcolor{comment}{// example: to print an int you would do}}
\DoxyCodeLine{\Hypertarget{_data_logging_8ino_source_l00103}00103 }
\DoxyCodeLine{\Hypertarget{_data_logging_8ino_source_l00104}00104   \textcolor{comment}{/*}}
\DoxyCodeLine{\Hypertarget{_data_logging_8ino_source_l00105}00105 \textcolor{comment}{    void *point = writer-\/>dataValues;}}
\DoxyCodeLine{\Hypertarget{_data_logging_8ino_source_l00106}00106 \textcolor{comment}{    for(int i = 0; i < writer-\/>dataValuesLen) \{}}
\DoxyCodeLine{\Hypertarget{_data_logging_8ino_source_l00107}00107 \textcolor{comment}{      switch(writer-\/>D\_TYPE) \{}}
\DoxyCodeLine{\Hypertarget{_data_logging_8ino_source_l00108}00108 \textcolor{comment}{        case FLOAT:}}
\DoxyCodeLine{\Hypertarget{_data_logging_8ino_source_l00109}00109 \textcolor{comment}{           sRecord.concat("{},"{}).concat(writer-\/>dataValues[i]);}}
\DoxyCodeLine{\Hypertarget{_data_logging_8ino_source_l00110}00110 \textcolor{comment}{           point += sizeof(float); // how much space the float took in memory}}
\DoxyCodeLine{\Hypertarget{_data_logging_8ino_source_l00111}00111 \textcolor{comment}{           break;}}
\DoxyCodeLine{\Hypertarget{_data_logging_8ino_source_l00112}00112 \textcolor{comment}{        case INT:}}
\DoxyCodeLine{\Hypertarget{_data_logging_8ino_source_l00113}00113 \textcolor{comment}{           sRecord.concat("{},"{}).concat(writer-\/>dataValues[i]);}}
\DoxyCodeLine{\Hypertarget{_data_logging_8ino_source_l00114}00114 \textcolor{comment}{           point += sizeof(int); // how much space the int took in memory}}
\DoxyCodeLine{\Hypertarget{_data_logging_8ino_source_l00115}00115 \textcolor{comment}{        case ... (can be any other D\_TYPE we define)}}
\DoxyCodeLine{\Hypertarget{_data_logging_8ino_source_l00116}00116 \textcolor{comment}{           ... (similar to previous two cases)}}
\DoxyCodeLine{\Hypertarget{_data_logging_8ino_source_l00117}00117 \textcolor{comment}{           break;}}
\DoxyCodeLine{\Hypertarget{_data_logging_8ino_source_l00118}00118 \textcolor{comment}{        default: Serial.printf("{}Unknown D\_TYPE: \%u\(\backslash\)n"{}, D\_TYPE); break;}}
\DoxyCodeLine{\Hypertarget{_data_logging_8ino_source_l00119}00119 \textcolor{comment}{      \}}}
\DoxyCodeLine{\Hypertarget{_data_logging_8ino_source_l00120}00120 \textcolor{comment}{    \}}}
\DoxyCodeLine{\Hypertarget{_data_logging_8ino_source_l00121}00121 \textcolor{comment}{  */}}
\DoxyCodeLine{\Hypertarget{_data_logging_8ino_source_l00122}00122   \textcolor{comment}{// I want to add it in now but it should be tested before being merged obviously... -\/ Chase}}
\DoxyCodeLine{\Hypertarget{_data_logging_8ino_source_l00123}00123 }
\DoxyCodeLine{\Hypertarget{_data_logging_8ino_source_l00124}00124   String sRecord = String(sTime);}
\DoxyCodeLine{\Hypertarget{_data_logging_8ino_source_l00125}00125   \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < writer-\/>\mbox{\hyperlink{struct_c_s_v_writer_a9bdd5e92c6749ab1c1d9a0ea7531315e}{dataValuesLen}}; i++) \{}
\DoxyCodeLine{\Hypertarget{_data_logging_8ino_source_l00126}00126     \textcolor{keywordflow}{if} (writer-\/>\mbox{\hyperlink{struct_c_s_v_writer_aa48db34eda8a982f97f2d7812fec0e27}{D\_TYPE}} == \mbox{\hyperlink{_data_logging_8h_ac2ad7f431e3446fddcd9b6b9f93c4c14a9cf4a0866224b0bb4a7a895da27c9c4c}{FLOAT}}) \{}
\DoxyCodeLine{\Hypertarget{_data_logging_8ino_source_l00127}00127       sRecord.concat(\textcolor{stringliteral}{"{},"{}}).concat(writer-\/>\mbox{\hyperlink{struct_c_s_v_writer_ad91f08cce2e394992128d934f3e881a9}{dataValues}}[i]);}
\DoxyCodeLine{\Hypertarget{_data_logging_8ino_source_l00128}00128     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (writer-\/>\mbox{\hyperlink{struct_c_s_v_writer_aa48db34eda8a982f97f2d7812fec0e27}{D\_TYPE}} == \mbox{\hyperlink{_data_logging_8h_ac2ad7f431e3446fddcd9b6b9f93c4c14afd5a5f51ce25953f3db2c7e93eb7864a}{INT}}) \{}
\DoxyCodeLine{\Hypertarget{_data_logging_8ino_source_l00129}00129       sRecord.concat(\textcolor{stringliteral}{"{},"{}}).concat(\textcolor{keywordtype}{int}(writer-\/>\mbox{\hyperlink{struct_c_s_v_writer_ad91f08cce2e394992128d934f3e881a9}{dataValues}}[i]));}
\DoxyCodeLine{\Hypertarget{_data_logging_8ino_source_l00130}00130     \}}
\DoxyCodeLine{\Hypertarget{_data_logging_8ino_source_l00131}00131   \}}
\DoxyCodeLine{\Hypertarget{_data_logging_8ino_source_l00132}00132   writer-\/>\mbox{\hyperlink{struct_c_s_v_writer_a134410cbaf84e674a0f3eb1465c37eaa}{file}}.println(sRecord);}
\DoxyCodeLine{\Hypertarget{_data_logging_8ino_source_l00133}00133 \}}
\DoxyCodeLine{\Hypertarget{_data_logging_8ino_source_l00134}00134 }
\DoxyCodeLine{\Hypertarget{_data_logging_8ino_source_l00135}00135 \textcolor{comment}{//startRecording sets the "{}epoch"{} or beginning time so that each data log is synced up}}
\DoxyCodeLine{\Hypertarget{_data_logging_8ino_source_l00136}\mbox{\hyperlink{_data_logging_8h_ab91616c118b701c2afd9136393d1f19b}{00136}} \textcolor{keywordtype}{void} \mbox{\hyperlink{_data_logging_8ino_ab91616c118b701c2afd9136393d1f19b}{startRecording}}() \{}
\DoxyCodeLine{\Hypertarget{_data_logging_8ino_source_l00137}00137   \mbox{\hyperlink{_data_logging_8h_a90b197693eeaad244ff381d5645b1c16}{epochTime}} = millis();}
\DoxyCodeLine{\Hypertarget{_data_logging_8ino_source_l00138}00138 \}}

\end{DoxyCode}
