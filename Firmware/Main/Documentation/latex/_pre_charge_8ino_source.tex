\hypertarget{_pre_charge_8ino_source}{}\doxysection{C\+:/\+Users/ponym/\+ARHMA2021/\+Firmware/\+Main/\+Pre\+Charge.ino}
\mbox{\hyperlink{_pre_charge_8ino}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00001}00001\ }
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00025}00025\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{_precharge_8h}{Precharge.h}}"{}}}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00026}00026\ \textcolor{preprocessor}{\#include\ <Wire.h>}}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00027}00027\ }
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00028}00028\ \textcolor{comment}{//\ I2C\ is\ incredibly\ unstable?\ Or\ perhaps\ not\ using\ proper\ wiring\ causes\ this,}}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00029}00029\ \textcolor{comment}{//\ but\ the\ reading\ in\ precharge\ data\ can\ often\ bug\ out\ and\ output}}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00030}00030\ \textcolor{comment}{//\ "{}nan"{}\ because\ of\ randomness?\ I\ would\ personally\ recommend}}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00031}00031\ \textcolor{comment}{//\ having\ some\ sort\ of\ true\ or\ false\ based}}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00032}00032\ \textcolor{comment}{//\ indicator\ at\ the\ bottom\ right\ of\ the\ speedometer\ screen}}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00033}00033\ \textcolor{comment}{//\ that\ outputs\ "{}true"{}\ or\ something\ to\ indicate}}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00034}00034\ \textcolor{comment}{//\ that\ the\ gyro\ is\ not\ bugging\ out.\ Or\ perhaps}}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00035}00035\ \textcolor{comment}{//\ output\ the\ gyro\ data\ on\ the\ bottom\ right}}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00036}00036\ \textcolor{comment}{//\ to\ indicate\ danger?\ Something\ like\ that.}}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00037}00037\ }
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00038}00038\ \textcolor{comment}{//\ OKAY,\ MAKE\ SURE\ YOU\ READ\ THIS\ IF\ YOU\ SEE\ ISSUES\ WITH\ THE\ GYRO.}}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00039}00039\ \textcolor{comment}{//\ By\ my\ *limited*\ understanding,\ I\ think\ the\ problem\ is\ that}}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00040}00040\ \textcolor{comment}{//\ the\ gyro\ needs\ to\ be\ consistently\ powered,\ hence\ why\ proper}}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00041}00041\ \textcolor{comment}{//\ gyro\ setup\ code\ has\ a\ significant\ delay\ between}}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00042}00042\ \textcolor{comment}{//\ turning\ the\ thing\ on\ and\ actually\ reading\ data\ from\ it.}}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00043}00043\ \textcolor{comment}{//\ An\ easy\ way\ to\ work\ around\ it,\ is\ to\ power\ on\ the\ Teensy}}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00044}00044\ \textcolor{comment}{//\ and\ then\ once\ everything\ is\ up\ and\ running,}}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00045}00045\ \textcolor{comment}{//\ reprogram\ it\ by\ using\ the\ button\ on\ the\ board.}}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00046}00046\ \textcolor{comment}{//\ In\ the\ case\ of\ the\ actual\ race,\ I\ would\ turn\ on\ low-\/voltage}}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00047}00047\ \textcolor{comment}{//\ and\ then\ wait\ a\ second\ and\ then\ turn\ it\ off\ and\ then}}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00048}00048\ \textcolor{comment}{//\ turn\ it\ back\ on.}}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00049}00049\ }
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00050}00050\ \textcolor{comment}{//\ The\ state\ HV\_PRECHARGING,\ HV\_ON\ are\ badly\ named.}}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00051}00051\ \textcolor{comment}{//\ The\ enum\ should\ be\ renamed\ to\ HV\_STATE}}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00052}00052\ \textcolor{comment}{//\ and\ instead\ we\ should\ have\ HV\_OFF,\ HV\_ON,\ HV\_ON\ states}}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00053}00053\ }
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00054}\mbox{\hyperlink{_pre_charge_8ino_a2cd6f5c27d7667dbd0b6a0bc756340a3}{00054}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{_pre_charge_8ino_a2cd6f5c27d7667dbd0b6a0bc756340a3}{prechargeTask}}(\textcolor{keywordtype}{void}\ *taskData)\ \{}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00055}00055\ \ \ \mbox{\hyperlink{struct_pre_charge_task_data}{PreChargeTaskData}}\ prechargeData\ =\ *(\mbox{\hyperlink{struct_pre_charge_task_data}{PreChargeTaskData}}\ *)taskData;}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00056}00056\ \ \ \textcolor{keywordflow}{while}\ (1)\ \{}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00057}00057\ \ \ \ \ \mbox{\hyperlink{_pre_charge_8ino_ad2376a25ab645f00587791af3c89968e}{preChargeCircuitFSMStateActions}}(prechargeData);}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00058}00058\ \ \ \ \ \mbox{\hyperlink{_pre_charge_8ino_ad5e3efaa785dcd1d9143ec7e5d117277}{preChargeCircuitFSMTransitions}}(prechargeData);}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00059}00059\ \ \ \ \ Serial.println(*\mbox{\hyperlink{_main_8h_a695dccac97a0f45cf570237e981b2b5d}{preChargeData}}.\mbox{\hyperlink{struct_pre_charge_task_data_a53289d52f48c067285cb843ef7470c9a}{angle\_X}});}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00060}00060\ \ \ \ \ Serial.println(*\mbox{\hyperlink{_main_8h_a695dccac97a0f45cf570237e981b2b5d}{preChargeData}}.\mbox{\hyperlink{struct_pre_charge_task_data_a7a48fc6887285d4cb55bff65fca23f36}{angle\_Y}});}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00061}00061\ \ \ \ \ \mbox{\hyperlink{_pre_charge_8ino_a87184d718be6821c71e697fc1fd98d3b}{updateGyroData}}(\mbox{\hyperlink{_main_8h_a695dccac97a0f45cf570237e981b2b5d}{preChargeData}});}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00062}00062\ }
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00063}00063\ \ \ \ \ \textcolor{comment}{//\ 100\ ms\ should\ be\ unnoticeable\ compared\ to\ other\ task\ updates}}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00064}00064\ \ \ \ \ \textcolor{comment}{//\ but\ should\ be\ fast\ to\ pick\ up\ errors\ /\ switch\ updates}}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00065}00065\ \ \ \ \ \mbox{\hyperlink{task_8h_aa154068cecd7f31446a7a84af44ab1a3}{vTaskDelay}}((1\ *\ \mbox{\hyperlink{_free_r_t_o_s_config__default_8h_a2f0258dd1e3b877e5bc013be54c2db6a}{configTICK\_RATE\_HZ}})\ /\ 1000);}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00066}00066\ \ \ \}}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00067}00067\ \}}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00068}00068\ }
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00069}00069\ \textcolor{comment}{//\ NOTE:\ "{}input"{}\ needs\ to\ change\ to\ the\ GPIO\ value\ for\ the\ on-\/button\ for\ the\ bike}}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00070}\mbox{\hyperlink{_precharge_8h_ad5e3efaa785dcd1d9143ec7e5d117277}{00070}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{_pre_charge_8ino_ad5e3efaa785dcd1d9143ec7e5d117277}{preChargeCircuitFSMTransitions}}\ (\mbox{\hyperlink{struct_pre_charge_task_data}{PreChargeTaskData}}\ \mbox{\hyperlink{_main_8h_a695dccac97a0f45cf570237e981b2b5d}{preChargeData}})\ \{}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00071}00071\ \ \ \mbox{\hyperlink{_precharge_8h_a5faacefaff4b0ce77f1f8be0bf2aaf29}{HV\_STATE}}\ old\_state\ =\ \mbox{\hyperlink{_precharge_8h_a5c9b1f4b5a31b5d46c45310567595867}{hv\_state}};}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00072}00072\ \ \ \textcolor{keywordflow}{switch}\ (\mbox{\hyperlink{_precharge_8h_a5c9b1f4b5a31b5d46c45310567595867}{hv\_state}})\ \{\ \textcolor{comment}{//\ transitions}}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00073}00073\ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{_precharge_8h_a5faacefaff4b0ce77f1f8be0bf2aaf29abc9f85ed087d13faf9b1c463431ee66a}{HV\_OFF}}:}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00074}00074\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{_pre_charge_8ino_a6798f4bd0a5b6353886f894b38b32473}{check\_HV\_TOGGLE}}())\ \{}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00075}00075\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{_precharge_8h_a5c9b1f4b5a31b5d46c45310567595867}{hv\_state}}\ =\ \mbox{\hyperlink{_precharge_8h_a5faacefaff4b0ce77f1f8be0bf2aaf29a2da9fa3988c31a60d94ee2a751ba32ce}{HV\_PRECHARGING}};}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00076}00076\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00077}00077\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00078}00078\ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{_precharge_8h_a5faacefaff4b0ce77f1f8be0bf2aaf29a2da9fa3988c31a60d94ee2a751ba32ce}{HV\_PRECHARGING}}:}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00079}00079\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{_pre_charge_8ino_a6798f4bd0a5b6353886f894b38b32473}{check\_HV\_TOGGLE}}())\ \{}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00080}00080\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ kill-\/switch\ activated\ or\ HV\ switch\ turned\ off}}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00081}00081\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{_precharge_8h_a5c9b1f4b5a31b5d46c45310567595867}{hv\_state}}\ =\ \mbox{\hyperlink{_precharge_8h_a5faacefaff4b0ce77f1f8be0bf2aaf29abc9f85ed087d13faf9b1c463431ee66a}{HV\_OFF}};}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00082}00082\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00083}00083\ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{_pre_charge_8ino_a65867cb936f7ef47ffd07fbfd4a91355}{isHVSafe}}(\mbox{\hyperlink{_main_8h_a695dccac97a0f45cf570237e981b2b5d}{preChargeData}}))\ \{}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00084}00084\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ HV\ error\ detected}}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00085}00085\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{_precharge_8h_a5c9b1f4b5a31b5d46c45310567595867}{hv\_state}}\ =\ \mbox{\hyperlink{_precharge_8h_a5faacefaff4b0ce77f1f8be0bf2aaf29a2303713b8a2ce365abb6b0de95c38595}{HV\_ERROR}};}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00086}00086\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00087}00087\ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{_pre_charge_8ino_a42b25fa6ccd2c8d82ba24c5ed4aaa7d1}{isPrecharged}}(\mbox{\hyperlink{_main_8h_a695dccac97a0f45cf570237e981b2b5d}{preChargeData}}))\ \{}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00088}00088\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ finished\ precharging}}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00089}00089\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{_precharge_8h_a5c9b1f4b5a31b5d46c45310567595867}{hv\_state}}\ =\ \mbox{\hyperlink{_precharge_8h_a5faacefaff4b0ce77f1f8be0bf2aaf29ab5febf14562b68ff6bdaaa86ec9b5dec}{HV\_ON}};}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00090}00090\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00091}00091\ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00092}00092\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ no\ updates,\ keep\ precharging}}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00093}00093\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{_precharge_8h_a5c9b1f4b5a31b5d46c45310567595867}{hv\_state}}\ =\ \mbox{\hyperlink{_precharge_8h_a5faacefaff4b0ce77f1f8be0bf2aaf29a2da9fa3988c31a60d94ee2a751ba32ce}{HV\_PRECHARGING}};}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00094}00094\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00095}00095\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00096}00096\ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{_precharge_8h_a5faacefaff4b0ce77f1f8be0bf2aaf29ab5febf14562b68ff6bdaaa86ec9b5dec}{HV\_ON}}:}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00097}00097\ \ \ \ \ \ \ \textcolor{comment}{//\ \ TODO:\ add\ another\ \&\&\ next\ to\ the\ !check\_HV\_TOGGLE,\ that\ essentially\ checks\ the\ measured\ angle\ >\ 45\ degrees\ on\ left\ or\ right\ side\ (+-\/\ 45\ degrees?)}}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00098}00098\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{_pre_charge_8ino_a6798f4bd0a5b6353886f894b38b32473}{check\_HV\_TOGGLE}}()\ ||\ *\mbox{\hyperlink{_main_8h_a695dccac97a0f45cf570237e981b2b5d}{preChargeData}}.\mbox{\hyperlink{struct_pre_charge_task_data_a7a48fc6887285d4cb55bff65fca23f36}{angle\_Y}}\ >\ 45\ ||\ *\mbox{\hyperlink{_main_8h_a695dccac97a0f45cf570237e981b2b5d}{preChargeData}}.\mbox{\hyperlink{struct_pre_charge_task_data_a7a48fc6887285d4cb55bff65fca23f36}{angle\_Y}}\ <\ -\/45\ ||\ *\mbox{\hyperlink{_main_8h_a695dccac97a0f45cf570237e981b2b5d}{preChargeData}}.\mbox{\hyperlink{struct_pre_charge_task_data_a53289d52f48c067285cb843ef7470c9a}{angle\_X}}\ >\ 45\ ||\ *\mbox{\hyperlink{_main_8h_a695dccac97a0f45cf570237e981b2b5d}{preChargeData}}.\mbox{\hyperlink{struct_pre_charge_task_data_a53289d52f48c067285cb843ef7470c9a}{angle\_X}}\ <\ -\/45)\ \{}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00099}00099\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ kill-\/switch\ activated\ or\ HV\ switch\ turned\ off}}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00100}00100\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{_precharge_8h_a5c9b1f4b5a31b5d46c45310567595867}{hv\_state}}\ =\ \mbox{\hyperlink{_precharge_8h_a5faacefaff4b0ce77f1f8be0bf2aaf29abc9f85ed087d13faf9b1c463431ee66a}{HV\_OFF}};}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00101}00101\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00102}00102\ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{_pre_charge_8ino_a65867cb936f7ef47ffd07fbfd4a91355}{isHVSafe}}(\mbox{\hyperlink{_main_8h_a695dccac97a0f45cf570237e981b2b5d}{preChargeData}}))\ \{}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00103}00103\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ HV\ error\ detected}}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00104}00104\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{_precharge_8h_a5c9b1f4b5a31b5d46c45310567595867}{hv\_state}}\ =\ \mbox{\hyperlink{_precharge_8h_a5faacefaff4b0ce77f1f8be0bf2aaf29a2303713b8a2ce365abb6b0de95c38595}{HV\_ERROR}};}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00105}00105\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00106}00106\ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00107}00107\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ no\ updates,\ keep\ HV\ on}}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00108}00108\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{_precharge_8h_a5c9b1f4b5a31b5d46c45310567595867}{hv\_state}}\ =\ \mbox{\hyperlink{_precharge_8h_a5faacefaff4b0ce77f1f8be0bf2aaf29ab5febf14562b68ff6bdaaa86ec9b5dec}{HV\_ON}};}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00109}00109\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00110}00110\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00111}00111\ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{_precharge_8h_a5faacefaff4b0ce77f1f8be0bf2aaf29a2303713b8a2ce365abb6b0de95c38595}{HV\_ERROR}}:}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00112}00112\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{_pre_charge_8ino_a65867cb936f7ef47ffd07fbfd4a91355}{isHVSafe}}(\mbox{\hyperlink{_main_8h_a695dccac97a0f45cf570237e981b2b5d}{preChargeData}}))\ \{}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00113}00113\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ if\ the\ error\ has\ been\ cleared}}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00114}00114\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{_precharge_8h_a5c9b1f4b5a31b5d46c45310567595867}{hv\_state}}\ =\ \mbox{\hyperlink{_precharge_8h_a5faacefaff4b0ce77f1f8be0bf2aaf29abc9f85ed087d13faf9b1c463431ee66a}{HV\_OFF}};}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00115}00115\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00116}00116\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ otherwise\ stay\ here}}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00117}00117\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{_precharge_8h_a5c9b1f4b5a31b5d46c45310567595867}{hv\_state}}\ =\ \mbox{\hyperlink{_precharge_8h_a5faacefaff4b0ce77f1f8be0bf2aaf29a2303713b8a2ce365abb6b0de95c38595}{HV\_ERROR}};}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00118}00118\ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00119}00119\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00120}00120\ \ \ \ \ \textcolor{keywordflow}{default}:}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00121}00121\ \ \ \ \ \ \ \mbox{\hyperlink{_precharge_8h_a5c9b1f4b5a31b5d46c45310567595867}{hv\_state}}\ =\ \mbox{\hyperlink{_precharge_8h_a5faacefaff4b0ce77f1f8be0bf2aaf29abc9f85ed087d13faf9b1c463431ee66a}{HV\_OFF}};}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00122}00122\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00123}00123\ \ \ \}\ \textcolor{comment}{//\ transitions}}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00124}00124\ }
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00125}00125\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{_precharge_8h_a5c9b1f4b5a31b5d46c45310567595867}{hv\_state}}\ !=\ old\_state)\ \{}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00126}00126\ \ \ \ \ Serial.printf(\textcolor{stringliteral}{"{}HV\ transitioned\ from\ \%s\ to\ \%s\ state\(\backslash\)n"{}},\ \mbox{\hyperlink{_pre_charge_8ino_a0a3e1d4e80c1320d3308a0e0bb10ac87}{state\_name}}(old\_state),\ \mbox{\hyperlink{_pre_charge_8ino_a0a3e1d4e80c1320d3308a0e0bb10ac87}{state\_name}}(\mbox{\hyperlink{_precharge_8h_a5c9b1f4b5a31b5d46c45310567595867}{hv\_state}}));}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00127}00127\ \ \ \}}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00128}00128\ \}}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00129}00129\ }
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00130}\mbox{\hyperlink{_precharge_8h_ad2376a25ab645f00587791af3c89968e}{00130}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{_pre_charge_8ino_ad2376a25ab645f00587791af3c89968e}{preChargeCircuitFSMStateActions}}\ (\mbox{\hyperlink{struct_pre_charge_task_data}{PreChargeTaskData}}\ \mbox{\hyperlink{_main_8h_a695dccac97a0f45cf570237e981b2b5d}{preChargeData}})\ \{}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00131}00131\ \ \ \textcolor{keywordflow}{switch}\ (\mbox{\hyperlink{_precharge_8h_a5c9b1f4b5a31b5d46c45310567595867}{hv\_state}})\ \{\ \textcolor{comment}{//\ state\ actions}}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00132}00132\ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{_precharge_8h_a5faacefaff4b0ce77f1f8be0bf2aaf29abc9f85ed087d13faf9b1c463431ee66a}{HV\_OFF}}:}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00133}00133\ \ \ \ \ \ \ digitalWrite(\mbox{\hyperlink{_precharge_8h_ae1099ac76283225ff2bbbbdc0819ba4e}{CONTACTOR}},\ LOW);}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00134}00134\ \ \ \ \ \ \ digitalWrite(\mbox{\hyperlink{_precharge_8h_a093dd273c900bae9cba2b32149e30eaa}{PRECHARGE}},\ LOW);}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00135}00135\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00136}00136\ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{_precharge_8h_a5faacefaff4b0ce77f1f8be0bf2aaf29a2da9fa3988c31a60d94ee2a751ba32ce}{HV\_PRECHARGING}}:}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00137}00137\ \ \ \ \ \ \ digitalWrite(\mbox{\hyperlink{_precharge_8h_ae1099ac76283225ff2bbbbdc0819ba4e}{CONTACTOR}},\ LOW);}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00138}00138\ \ \ \ \ \ \ digitalWrite(\mbox{\hyperlink{_precharge_8h_a093dd273c900bae9cba2b32149e30eaa}{PRECHARGE}},\ HIGH);}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00139}00139\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00140}00140\ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{_precharge_8h_a5faacefaff4b0ce77f1f8be0bf2aaf29ab5febf14562b68ff6bdaaa86ec9b5dec}{HV\_ON}}:}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00141}00141\ \ \ \ \ \ \ digitalWrite(\mbox{\hyperlink{_precharge_8h_ae1099ac76283225ff2bbbbdc0819ba4e}{CONTACTOR}},\ HIGH);}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00142}00142\ \ \ \ \ \ \ digitalWrite(\mbox{\hyperlink{_precharge_8h_a093dd273c900bae9cba2b32149e30eaa}{PRECHARGE}},\ LOW);}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00143}00143\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00144}00144\ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{_precharge_8h_a5faacefaff4b0ce77f1f8be0bf2aaf29a2303713b8a2ce365abb6b0de95c38595}{HV\_ERROR}}:}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00145}00145\ \ \ \ \ \ \ digitalWrite(\mbox{\hyperlink{_precharge_8h_ae1099ac76283225ff2bbbbdc0819ba4e}{CONTACTOR}},\ LOW);}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00146}00146\ \ \ \ \ \ \ digitalWrite(\mbox{\hyperlink{_precharge_8h_a093dd273c900bae9cba2b32149e30eaa}{PRECHARGE}},\ LOW);}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00147}00147\ \ \ \ \ \textcolor{keywordflow}{default}:}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00148}00148\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00149}00149\ \ \ \}\ \textcolor{comment}{//\ state\ actions}}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00150}00150\ \}}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00151}00151\ }
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00152}00152\ \textcolor{comment}{//\ Returns\ true\ if\ the\ motor\ controller\ is\ done\ precharging.}}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00153}00153\ \textcolor{comment}{//\ Returns\ false\ otherwise.}}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00154}\mbox{\hyperlink{_precharge_8h_a42b25fa6ccd2c8d82ba24c5ed4aaa7d1}{00154}}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{_pre_charge_8ino_a42b25fa6ccd2c8d82ba24c5ed4aaa7d1}{isPrecharged}}(\mbox{\hyperlink{struct_pre_charge_task_data}{PreChargeTaskData}}\ \mbox{\hyperlink{_main_8h_a695dccac97a0f45cf570237e981b2b5d}{preChargeData}})\ \{}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00155}00155\ }
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00156}00156\ \ \ \textcolor{comment}{//\ Ret\ false\ if\ we\ haven't\ received\ all\ BMS\ cell\ voltages\ yet}}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00157}00157\ \ \ \textcolor{keywordflow}{if}\ (*\mbox{\hyperlink{_main_8h_a695dccac97a0f45cf570237e981b2b5d}{preChargeData}}.\mbox{\hyperlink{struct_pre_charge_task_data_afdfc29c3040101593d7d298c7b432132}{cellVoltages}}.\mbox{\hyperlink{struct_cell_voltages_a844b5b2d0bd58e1147076ab8aacc420a}{ready}})\ \{}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00158}00158\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00159}00159\ \ \ \}}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00160}00160\ }
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00161}00161\ \ \ \textcolor{comment}{//\ Ret\ true\ if\ the\ difference\ between\ the\ main-\/accumulator-\/series-\/voltage\ and\ the}}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00162}00162\ \ \ \textcolor{comment}{//\ motorcontroller-\/voltage\ is\ less\ than\ 10\%\ of\ the\ main-\/accumulator-\/series-\/voltage}}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00163}00163\ \ \ \textcolor{keywordflow}{return}\ ((*\mbox{\hyperlink{_main_8h_a695dccac97a0f45cf570237e981b2b5d}{preChargeData}}.\mbox{\hyperlink{struct_pre_charge_task_data_afdfc29c3040101593d7d298c7b432132}{cellVoltages}}.\mbox{\hyperlink{struct_cell_voltages_a739cccc4cfe6c366e7474ae1c71097bf}{seriesVoltage}}\ -\/\ *\mbox{\hyperlink{_main_8h_a695dccac97a0f45cf570237e981b2b5d}{preChargeData}}.\mbox{\hyperlink{struct_pre_charge_task_data_aae4496a1b8d72f6107bdfcf81472741b}{motorControllerBatteryVoltage}})\ <=\ (*\mbox{\hyperlink{_main_8h_a695dccac97a0f45cf570237e981b2b5d}{preChargeData}}.\mbox{\hyperlink{struct_pre_charge_task_data_afdfc29c3040101593d7d298c7b432132}{cellVoltages}}.\mbox{\hyperlink{struct_cell_voltages_a739cccc4cfe6c366e7474ae1c71097bf}{seriesVoltage}}\ *\ 0.1)\ \&\&}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00164}00164\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//and\ main-\/accumulator-\/voltage\ is\ greater\ than\ 80V\ (but\ this\ should\ be\ changed\ later\ as\ the\ bike\ voltage\ may\ be\ as\ low\ as\ \string~60V).}}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00165}00165\ \ \ \ \ \ \ \ \ \ \ *\mbox{\hyperlink{_main_8h_a695dccac97a0f45cf570237e981b2b5d}{preChargeData}}.\mbox{\hyperlink{struct_pre_charge_task_data_afdfc29c3040101593d7d298c7b432132}{cellVoltages}}.\mbox{\hyperlink{struct_cell_voltages_a739cccc4cfe6c366e7474ae1c71097bf}{seriesVoltage}}\ >\ 80);}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00166}00166\ \}}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00167}00167\ }
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00168}00168\ \textcolor{comment}{//\ this\ function\ returns\ true\ if\ there\ are\ no\ HV\ errors\ detected\ on\ the\ bike}}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00169}\mbox{\hyperlink{_precharge_8h_a65867cb936f7ef47ffd07fbfd4a91355}{00169}}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{_pre_charge_8ino_a65867cb936f7ef47ffd07fbfd4a91355}{isHVSafe}}(\mbox{\hyperlink{struct_pre_charge_task_data}{PreChargeTaskData}}\ \mbox{\hyperlink{_main_8h_a695dccac97a0f45cf570237e981b2b5d}{preChargeData}})\ \{}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00170}00170\ \ \ \textcolor{comment}{//BMSStatus\ bmsStatus\ =\ preChargeData.bmsStatus;}}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00171}00171\ \ \ \mbox{\hyperlink{struct_motor_temps}{MotorTemps}}\ \mbox{\hyperlink{_main_8h_abb61c6dc61d12b31aad7bdadd495b70a}{motorTemps}}\ =\ \mbox{\hyperlink{_main_8h_a695dccac97a0f45cf570237e981b2b5d}{preChargeData}}.\mbox{\hyperlink{struct_pre_charge_task_data_a3e8e3c4386b66dbf1011082b1f8ce7aa}{motorTemps}};}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00172}00172\ }
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00173}00173\ \ \ \textcolor{comment}{/*\ !!!!\ these\ are\ commented\ out\ now\ but\ all\ of\ this\ should\ be\ checked\ when\ using\ the\ real\ bike\ !!!!}}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00174}00174\ \textcolor{comment}{\ \ \ \ though\ you\ will\ have\ to\ determine\ which\ of\ these\ are\ emergency\ HV\ states.\ i.e.\ Which\ ones\ should\ turn\ off\ the\ contactor\ instantly}}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00175}00175\ \textcolor{comment}{\ \ \ \ and\ which\ ones\ should\ you\ simply\ alert\ the\ rider?}}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00176}00176\ \textcolor{comment}{\ \ \ \ As\ of\ now,\ they\ all\ immediately\ turn\ off\ the\ contactor\ which\ may\ be\ dangerous\ for\ the\ rider}}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00177}00177\ \textcolor{comment}{\ \ */}}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00178}00178\ }
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00179}00179\ \ \ \textcolor{comment}{//if\ (*bmsStatus.ltc\_fault\ ==\ 1)\ return\ 0;}}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00180}00180\ \ \ \textcolor{comment}{//if\ (*bmsStatus.ltc\_count\ !=\ NUMBER\_OF\_LTCS)\ return\ 0;}}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00181}00181\ \ \ \textcolor{comment}{//\ \ \ \ the\ below\ if\ can\ be\ reduced\ to\ if\ (*bmsStatus.bms\_c\_fault)\ which\ returns\ true\ for\ any\ non-\/zero\ bms\_c\_fault\ value}}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00182}00182\ \ \ \textcolor{comment}{//if\ (*bmsStatus.bms\_c\_fault\ ==\ 1\ ||\ *bmsStatus.bms\_c\_fault\ ==\ 2\ ||\ *bmsStatus.bms\_c\_fault\ ==\ 4\ ||\ \ \ \ //checks\ BMS\ fault\ error\ codes}}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00183}00183\ \ \ \textcolor{comment}{//\ \ \ \ *bmsStatus.bms\_c\_fault\ ==\ 8)\ return\ 0;}}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00184}00184\ \ \ \textcolor{comment}{//if\ (*bmsStatus.bms\_status\_flag\ ==\ 1\ ||\ *bmsStatus.bms\_status\_flag\ ==\ 2)\ return\ 0;\ \ //check\ if\ cells\ are\ above\ or\ below\ the\ voltage\ cutoffs}}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00185}00185\ \ \ \textcolor{keywordflow}{if}\ (*\mbox{\hyperlink{_main_8h_abb61c6dc61d12b31aad7bdadd495b70a}{motorTemps}}.\mbox{\hyperlink{struct_motor_temps_a1c8b1bb77f968573fe2d1af0a0815d35}{motorControllerTemperature}}\ >=\ \mbox{\hyperlink{_precharge_8h_a1f9513787cfe256aae379719ab26ca39}{MOTORCONTROLLER\_TEMP\_MAX}}}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00186}00186\ \ \ \ \ \ \ ||\ *\mbox{\hyperlink{_main_8h_abb61c6dc61d12b31aad7bdadd495b70a}{motorTemps}}.\mbox{\hyperlink{struct_motor_temps_ad9864aa48ce76c5965919c459cc6e9b7}{motorTemperature}}\ >=\ \mbox{\hyperlink{_precharge_8h_aa39f17be3d8f2f799f7fbd0dc01963db}{MOTOR\_TEMP\_MAX}})\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ 0;}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00187}00187\ \ \ \textcolor{keywordflow}{return}\ 1;}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00188}00188\ \}}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00189}00189\ }
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00190}\mbox{\hyperlink{_precharge_8h_a6798f4bd0a5b6353886f894b38b32473}{00190}}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{_pre_charge_8ino_a6798f4bd0a5b6353886f894b38b32473}{check\_HV\_TOGGLE}}()\ \{}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00191}00191\ \ \ \textcolor{keywordflow}{return}\ !digitalRead(\mbox{\hyperlink{_precharge_8h_a4e1dc017df18faad4234012c3e88d2f6}{HIGH\_VOLTAGE\_TOGGLE}});}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00192}00192\ \}}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00193}00193\ }
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00194}\mbox{\hyperlink{_precharge_8h_a0a3e1d4e80c1320d3308a0e0bb10ac87}{00194}}\ \textcolor{keywordtype}{char}*\ \mbox{\hyperlink{_pre_charge_8ino_a0a3e1d4e80c1320d3308a0e0bb10ac87}{state\_name}}(\mbox{\hyperlink{_precharge_8h_a5faacefaff4b0ce77f1f8be0bf2aaf29}{HV\_STATE}}\ state)\ \{}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00195}00195\ \ \ \textcolor{keywordflow}{switch}\ (state)\ \{}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00196}00196\ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{_precharge_8h_a5faacefaff4b0ce77f1f8be0bf2aaf29abc9f85ed087d13faf9b1c463431ee66a}{HV\_OFF}}:\ \textcolor{keywordflow}{return}\ \textcolor{stringliteral}{"{}HV\_OFF"{}};}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00197}00197\ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{_precharge_8h_a5faacefaff4b0ce77f1f8be0bf2aaf29a2da9fa3988c31a60d94ee2a751ba32ce}{HV\_PRECHARGING}}:\ \textcolor{keywordflow}{return}\ \textcolor{stringliteral}{"{}HV\_PRECHARGING"{}};}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00198}00198\ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{_precharge_8h_a5faacefaff4b0ce77f1f8be0bf2aaf29ab5febf14562b68ff6bdaaa86ec9b5dec}{HV\_ON}}:\ \textcolor{keywordflow}{return}\ \textcolor{stringliteral}{"{}HV\_ON"{}};}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00199}00199\ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{_precharge_8h_a5faacefaff4b0ce77f1f8be0bf2aaf29a2303713b8a2ce365abb6b0de95c38595}{HV\_ERROR}}:\ \textcolor{keywordflow}{return}\ \textcolor{stringliteral}{"{}HV\_ERROR"{}};}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00200}00200\ \ \ \}}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00201}00201\ \}}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00202}00202\ }
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00203}\mbox{\hyperlink{_precharge_8h_a5782bd590f95fb2269eb43a3d70c18f4}{00203}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{_pre_charge_8ino_a5782bd590f95fb2269eb43a3d70c18f4}{setupI2C}}(\mbox{\hyperlink{struct_pre_charge_task_data}{PreChargeTaskData}}\ \mbox{\hyperlink{_main_8h_a695dccac97a0f45cf570237e981b2b5d}{preChargeData}})\ \{}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00204}00204\ \ \ Wire.setClock(400000);\ \textcolor{comment}{//\ MPU6050\ supports\ up\ to\ 400k\ Hz\ in\ specifications}}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00205}00205\ \ \ Wire.begin();}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00206}00206\ \ \ delay(50);\ \textcolor{comment}{//\ give\ delay\ for\ device\ to\ start}}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00207}00207\ }
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00208}00208\ \ \ \textcolor{comment}{//\ Start\ gyro\ in\ power\ mode}}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00209}00209\ \ \ Wire.beginTransmission(0x68);}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00210}00210\ \ \ Wire.write(0x6B);\ \textcolor{comment}{//\ 6B\ is\ relevant\ register}}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00211}00211\ \ \ Wire.write(0x00);\ \textcolor{comment}{//\ all\ bits\ must\ be\ 0\ to\ start\ and\ continue\ device}}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00212}00212\ \ \ Wire.endTransmission();}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00213}00213\ }
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00214}00214\ \ \ \textcolor{comment}{//\ Perform\ gyroscope\ calibration\ measurements}}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00215}00215\ \ \ \textcolor{comment}{//\ 2000\ milliseconds\ =\ 2\ seconds\ to\ add\ all\ measured\ variables\ to\ calibration\ variables}}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00216}00216\ \ \ \textcolor{comment}{//\ This\ is\ important\ because\ this\ solves\ the\ issue\ of\ a\ non-\/zero\ rotation\ rate\ when\ stationary}}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00217}00217\ \ \ \textcolor{keywordflow}{for}\ (*\mbox{\hyperlink{_main_8h_a695dccac97a0f45cf570237e981b2b5d}{preChargeData}}.\mbox{\hyperlink{struct_pre_charge_task_data_ab12a4f264d6acfdf84ce67728ecb42b2}{RateCalibrationNumber}}\ =\ 0;\ *\mbox{\hyperlink{_main_8h_a695dccac97a0f45cf570237e981b2b5d}{preChargeData}}.\mbox{\hyperlink{struct_pre_charge_task_data_ab12a4f264d6acfdf84ce67728ecb42b2}{RateCalibrationNumber}}\ <\ 2000;\ *\mbox{\hyperlink{_main_8h_a695dccac97a0f45cf570237e981b2b5d}{preChargeData}}.\mbox{\hyperlink{struct_pre_charge_task_data_ab12a4f264d6acfdf84ce67728ecb42b2}{RateCalibrationNumber}}++)\ \{}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00218}00218\ \ \ \ \ \mbox{\hyperlink{_pre_charge_8ino_ad8511ef84de5112bd6beb8e3ac5fff67}{gyro\_signals}}(\mbox{\hyperlink{_main_8h_a695dccac97a0f45cf570237e981b2b5d}{preChargeData}});}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00219}00219\ \ \ \ \ *\mbox{\hyperlink{_main_8h_a695dccac97a0f45cf570237e981b2b5d}{preChargeData}}.\mbox{\hyperlink{struct_pre_charge_task_data_a4d7799e4a73f6488e3296c35f66c2e30}{RateCalibrationRoll}}\ +=\ *\mbox{\hyperlink{_main_8h_a695dccac97a0f45cf570237e981b2b5d}{preChargeData}}.\mbox{\hyperlink{struct_pre_charge_task_data_a33b675970bf11d7e27edf3b542431997}{RateRoll}};}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00220}00220\ \ \ \ \ *\mbox{\hyperlink{_main_8h_a695dccac97a0f45cf570237e981b2b5d}{preChargeData}}.\mbox{\hyperlink{struct_pre_charge_task_data_a80f6f899a8c9d6b3e7850f52350a414d}{RateCalibrationPitch}}\ +=\ *\mbox{\hyperlink{_main_8h_a695dccac97a0f45cf570237e981b2b5d}{preChargeData}}.\mbox{\hyperlink{struct_pre_charge_task_data_afc133d30f22f7a7f72ee498b3d69be82}{RatePitch}};}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00221}00221\ \ \ \ \ *\mbox{\hyperlink{_main_8h_a695dccac97a0f45cf570237e981b2b5d}{preChargeData}}.\mbox{\hyperlink{struct_pre_charge_task_data_aa0d6bb3b938787ae1de06d67d1e3deaf}{RateCalibrationYaw}}\ +=\ *\mbox{\hyperlink{_main_8h_a695dccac97a0f45cf570237e981b2b5d}{preChargeData}}.\mbox{\hyperlink{struct_pre_charge_task_data_aaf5cdfb5b1dd1857d4082f3a014ffb51}{RateYaw}};}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00222}00222\ \ \ \ \ delay(1);}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00223}00223\ \ \ \}}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00224}00224\ }
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00225}00225\ \ \ \textcolor{comment}{//\ Take\ average\ of\ calibrated\ rotation\ rate\ values\ from\ each\ direction}}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00226}00226\ \ \ *\mbox{\hyperlink{_main_8h_a695dccac97a0f45cf570237e981b2b5d}{preChargeData}}.\mbox{\hyperlink{struct_pre_charge_task_data_a4d7799e4a73f6488e3296c35f66c2e30}{RateCalibrationRoll}}\ /=\ 2000;}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00227}00227\ \ \ *\mbox{\hyperlink{_main_8h_a695dccac97a0f45cf570237e981b2b5d}{preChargeData}}.\mbox{\hyperlink{struct_pre_charge_task_data_a80f6f899a8c9d6b3e7850f52350a414d}{RateCalibrationPitch}}\ /=\ 2000;}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00228}00228\ \ \ *\mbox{\hyperlink{_main_8h_a695dccac97a0f45cf570237e981b2b5d}{preChargeData}}.\mbox{\hyperlink{struct_pre_charge_task_data_aa0d6bb3b938787ae1de06d67d1e3deaf}{RateCalibrationYaw}}\ /=\ 2000;}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00229}00229\ \ \ \textcolor{comment}{//\ \ *preChargeData.LoopTimer\ =\ micros();}}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00230}00230\ \}}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00231}00231\ }
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00232}\mbox{\hyperlink{_precharge_8h_ad8511ef84de5112bd6beb8e3ac5fff67}{00232}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{_pre_charge_8ino_ad8511ef84de5112bd6beb8e3ac5fff67}{gyro\_signals}}(\mbox{\hyperlink{struct_pre_charge_task_data}{PreChargeTaskData}}\ \mbox{\hyperlink{_main_8h_a695dccac97a0f45cf570237e981b2b5d}{preChargeData}})\ \{}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00233}00233\ \ \ \textcolor{comment}{//\ Start\ I2C\ communication\ with\ MPU6050}}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00234}00234\ \ \ Wire.beginTransmission(0x68);\ \textcolor{comment}{//\ 0x68\ is\ default\ register\ value\ for\ MPU6050}}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00235}00235\ }
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00236}00236\ \ \ \textcolor{comment}{//\ Switch\ on\ low\ pass\ filter}}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00237}00237\ \ \ Wire.write(0x1A);\ \textcolor{comment}{//\ activate\ low\ pass\ filter}}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00238}00238\ \ \ Wire.write(0x05);\ \textcolor{comment}{//\ cut\ off\ frequency\ of\ 10\ Hz}}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00239}00239\ \ \ Wire.endTransmission();}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00240}00240\ }
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00241}00241\ \ \ \textcolor{comment}{//\ Configure\ accelerometer\ output}}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00242}00242\ \ \ Wire.beginTransmission(0x68);}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00243}00243\ \ \ Wire.write(0x1C);\ \textcolor{comment}{//\ 1C\ is\ relevant\ register}}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00244}00244\ \ \ Wire.write(0x10);\ \textcolor{comment}{//\ full\ scale\ range\ of\ +/-\/8g}}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00245}00245\ \ \ Wire.endTransmission();}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00246}00246\ }
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00247}00247\ \ \ \textcolor{comment}{//\ Access\ registers\ storing\ accelerometer\ measurements}}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00248}00248\ \ \ Wire.beginTransmission(0x68);}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00249}00249\ \ \ Wire.write(0x3B);}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00250}00250\ \ \ Wire.endTransmission();}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00251}00251\ \ \ Wire.requestFrom(0x68,\ 6);}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00252}00252\ }
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00253}00253\ \ \ \textcolor{comment}{//\ Read\ accelerometer\ measurements}}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00254}00254\ \ \ int16\_t\ AccXLSB\ =\ Wire.read()\ <<\ 8\ |\ Wire.read();\ \textcolor{comment}{//\ x-\/direction}}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00255}00255\ \ \ int16\_t\ AccYLSB\ =\ Wire.read()\ <<\ 8\ |\ Wire.read();\ \textcolor{comment}{//\ y-\/direction}}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00256}00256\ \ \ int16\_t\ AccZLSB\ =\ Wire.read()\ <<\ 8\ |\ Wire.read();\ \textcolor{comment}{//\ z-\/direction}}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00257}00257\ }
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00258}00258\ \ \ \textcolor{comment}{//\ Configure\ gyroscope\ output\ and\ pull\ rotation\ rate\ measurements\ from\ sensor}}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00259}00259\ \ \ \textcolor{comment}{//\ Set\ sensitivity\ scale\ factor}}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00260}00260\ \ \ Wire.beginTransmission(0x68);}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00261}00261\ \ \ Wire.write(0x1B);\ \textcolor{comment}{//\ 1B\ is\ hexadecimal\ associated\ with\ gyroscope\ configuration}}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00262}00262\ \ \ Wire.write(0x8);\ \textcolor{comment}{//\ 8\ is\ hexadecimal\ for\ LSB\ sensitivity\ of\ 65.6\ LSB/degree/second}}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00263}00263\ \ \ Wire.endTransmission();}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00264}00264\ }
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00265}00265\ \ \ \textcolor{comment}{//\ Access\ registers\ storing\ gyro\ measurements}}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00266}00266\ \ \ Wire.beginTransmission(0x68);}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00267}00267\ \ \ Wire.write(0x43);}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00268}00268\ \ \ Wire.endTransmission();}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00269}00269\ \ \ Wire.requestFrom(0x68,\ 6);}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00270}00270\ }
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00271}00271\ \ \ \textcolor{comment}{//\ Read\ gyro\ measurements}}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00272}00272\ \ \ int16\_t\ GyroX\ =\ Wire.read()\ <<\ 8\ |\ Wire.read();\ \textcolor{comment}{//\ around\ x-\/axis}}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00273}00273\ \ \ int16\_t\ GyroY\ =\ Wire.read()\ <<\ 8\ |\ Wire.read();\ \textcolor{comment}{//\ around\ y-\/axis}}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00274}00274\ \ \ int16\_t\ GyroZ\ =\ Wire.read()\ <<\ 8\ |\ Wire.read();\ \textcolor{comment}{//\ around\ z-\/axis}}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00275}00275\ }
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00276}00276\ \ \ \textcolor{comment}{//\ Convert\ measurement\ units\ to\ degree/second}}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00277}00277\ \ \ *\mbox{\hyperlink{_main_8h_a695dccac97a0f45cf570237e981b2b5d}{preChargeData}}.\mbox{\hyperlink{struct_pre_charge_task_data_a33b675970bf11d7e27edf3b542431997}{RateRoll}}\ =\ (float)GyroX\ /\ 65.5;}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00278}00278\ \ \ *\mbox{\hyperlink{_main_8h_a695dccac97a0f45cf570237e981b2b5d}{preChargeData}}.\mbox{\hyperlink{struct_pre_charge_task_data_afc133d30f22f7a7f72ee498b3d69be82}{RatePitch}}\ =\ (float)GyroY\ /\ 65.5;}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00279}00279\ \ \ *\mbox{\hyperlink{_main_8h_a695dccac97a0f45cf570237e981b2b5d}{preChargeData}}.\mbox{\hyperlink{struct_pre_charge_task_data_aaf5cdfb5b1dd1857d4082f3a014ffb51}{RateYaw}}\ =\ (float)GyroZ\ /\ 65.5;}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00280}00280\ }
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00281}00281\ \ \ \textcolor{comment}{//\ Convert\ measurements\ to\ from\ LSB\ to\ g}}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00282}00282\ \ \ \textcolor{comment}{//\ Divide\ 4096\ because\ full\ range\ +/-\/8g\ is\ associated\ with\ 4096\ LSB/g}}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00283}00283\ \ \ *\mbox{\hyperlink{_main_8h_a695dccac97a0f45cf570237e981b2b5d}{preChargeData}}.\mbox{\hyperlink{struct_pre_charge_task_data_a3c051d79159770c924eda82743ba8d81}{AccX}}\ =\ (float)AccXLSB\ /\ 4096;}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00284}00284\ \ \ *\mbox{\hyperlink{_main_8h_a695dccac97a0f45cf570237e981b2b5d}{preChargeData}}.\mbox{\hyperlink{struct_pre_charge_task_data_a80f0e6e50839ffb0fc6d04cd3d871a3f}{AccY}}\ =\ (float)AccYLSB\ /\ 4096;}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00285}00285\ \ \ *\mbox{\hyperlink{_main_8h_a695dccac97a0f45cf570237e981b2b5d}{preChargeData}}.\mbox{\hyperlink{struct_pre_charge_task_data_a3bb9585d2c3e9ee02ed1f98f706426b3}{AccZ}}\ =\ (float)AccZLSB\ /\ 4096;}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00286}00286\ }
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00287}00287\ \ \ \textcolor{keywordtype}{float}\ AccX\ =\ *\mbox{\hyperlink{_main_8h_a695dccac97a0f45cf570237e981b2b5d}{preChargeData}}.\mbox{\hyperlink{struct_pre_charge_task_data_a3c051d79159770c924eda82743ba8d81}{AccX}};}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00288}00288\ \ \ \textcolor{keywordtype}{float}\ AccY\ =\ *\mbox{\hyperlink{_main_8h_a695dccac97a0f45cf570237e981b2b5d}{preChargeData}}.\mbox{\hyperlink{struct_pre_charge_task_data_a80f0e6e50839ffb0fc6d04cd3d871a3f}{AccY}};}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00289}00289\ \ \ \textcolor{keywordtype}{float}\ AccZ\ =\ *\mbox{\hyperlink{_main_8h_a695dccac97a0f45cf570237e981b2b5d}{preChargeData}}.\mbox{\hyperlink{struct_pre_charge_task_data_a3bb9585d2c3e9ee02ed1f98f706426b3}{AccZ}};}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00290}00290\ }
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00291}00291\ \ \ \textcolor{comment}{//\ Calculate\ absolute\ angles}}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00292}00292\ \ \ \textcolor{comment}{//\ IMPORTANT\ LINE\ OF\ CODE:}}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00293}00293\ \ \ \textcolor{comment}{//\ \ \ \ -\/\ WE\ CAN\ ADD\ OR\ SUBTRACT\ FROM\ THE\ ANGLE\ DEPENDING\ ON\ THE\ PLACEMENT\ OF\ GYROSCOPE}}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00294}00294\ \ \ \textcolor{comment}{//\ \ \ \ -\/\ EX:\ If\ MPU6050\ is\ laid\ on\ port\ side,\ add\ 90\ to\ AnglePitch}}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00295}00295\ \ \ *\mbox{\hyperlink{_main_8h_a695dccac97a0f45cf570237e981b2b5d}{preChargeData}}.\mbox{\hyperlink{struct_pre_charge_task_data_a99d4f80bc2e399c388039183debf146a}{AngleRoll}}\ =\ (atan(AccY\ /\ sqrt(AccX\ *\ AccX\ +\ AccZ\ *\ AccZ))\ *\ 1\ /\ (3.142\ /\ 180))\ +\ 5;}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00296}00296\ \ \ *\mbox{\hyperlink{_main_8h_a695dccac97a0f45cf570237e981b2b5d}{preChargeData}}.\mbox{\hyperlink{struct_pre_charge_task_data_a4bb0f04e326928d80e286b279ca81003}{AnglePitch}}\ =\ (-\/atan(AccX\ /\ sqrt(AccY\ *\ AccY\ +\ AccZ\ *\ AccZ))\ *\ 1\ /\ (3.142\ /\ 180));}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00297}00297\ \}}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00298}00298\ }
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00299}\mbox{\hyperlink{_precharge_8h_a87184d718be6821c71e697fc1fd98d3b}{00299}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{_pre_charge_8ino_a87184d718be6821c71e697fc1fd98d3b}{updateGyroData}}(\mbox{\hyperlink{struct_pre_charge_task_data}{PreChargeTaskData}}\ \mbox{\hyperlink{_main_8h_a695dccac97a0f45cf570237e981b2b5d}{preChargeData}})\ \{}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00300}00300\ \ \ \mbox{\hyperlink{_pre_charge_8ino_ad8511ef84de5112bd6beb8e3ac5fff67}{gyro\_signals}}(\mbox{\hyperlink{_main_8h_a695dccac97a0f45cf570237e981b2b5d}{preChargeData}});}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00301}00301\ }
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00302}00302\ \ \ *\mbox{\hyperlink{_main_8h_a695dccac97a0f45cf570237e981b2b5d}{preChargeData}}.\mbox{\hyperlink{struct_pre_charge_task_data_a33b675970bf11d7e27edf3b542431997}{RateRoll}}\ -\/=\ *\mbox{\hyperlink{_main_8h_a695dccac97a0f45cf570237e981b2b5d}{preChargeData}}.\mbox{\hyperlink{struct_pre_charge_task_data_a4d7799e4a73f6488e3296c35f66c2e30}{RateCalibrationRoll}};}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00303}00303\ \ \ *\mbox{\hyperlink{_main_8h_a695dccac97a0f45cf570237e981b2b5d}{preChargeData}}.\mbox{\hyperlink{struct_pre_charge_task_data_afc133d30f22f7a7f72ee498b3d69be82}{RatePitch}}\ -\/=\ *\mbox{\hyperlink{_main_8h_a695dccac97a0f45cf570237e981b2b5d}{preChargeData}}.\mbox{\hyperlink{struct_pre_charge_task_data_a80f6f899a8c9d6b3e7850f52350a414d}{RateCalibrationPitch}};}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00304}00304\ \ \ *\mbox{\hyperlink{_main_8h_a695dccac97a0f45cf570237e981b2b5d}{preChargeData}}.\mbox{\hyperlink{struct_pre_charge_task_data_aaf5cdfb5b1dd1857d4082f3a014ffb51}{RateYaw}}\ -\/=\ *\mbox{\hyperlink{_main_8h_a695dccac97a0f45cf570237e981b2b5d}{preChargeData}}.\mbox{\hyperlink{struct_pre_charge_task_data_aa0d6bb3b938787ae1de06d67d1e3deaf}{RateCalibrationYaw}};}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00305}00305\ }
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00306}00306\ \ \ \textcolor{comment}{//\ Calculate\ Roll\ angle\ (around\ x\ axis)}}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00307}00307\ \ \ \mbox{\hyperlink{_pre_charge_8ino_ade8f654468b951602d2622b34902944f}{kalman\_1d}}(*\mbox{\hyperlink{_main_8h_a695dccac97a0f45cf570237e981b2b5d}{preChargeData}}.\mbox{\hyperlink{struct_pre_charge_task_data_a53289d52f48c067285cb843ef7470c9a}{angle\_X}},\ *\mbox{\hyperlink{_main_8h_a695dccac97a0f45cf570237e981b2b5d}{preChargeData}}.\mbox{\hyperlink{struct_pre_charge_task_data_a56b12f35d375a77d39a5067b35701ec6}{KalmanUncertaintyAngleRoll}},\ *\mbox{\hyperlink{_main_8h_a695dccac97a0f45cf570237e981b2b5d}{preChargeData}}.\mbox{\hyperlink{struct_pre_charge_task_data_a33b675970bf11d7e27edf3b542431997}{RateRoll}},\ *\mbox{\hyperlink{_main_8h_a695dccac97a0f45cf570237e981b2b5d}{preChargeData}}.\mbox{\hyperlink{struct_pre_charge_task_data_a99d4f80bc2e399c388039183debf146a}{AngleRoll}},\ \mbox{\hyperlink{_main_8h_a695dccac97a0f45cf570237e981b2b5d}{preChargeData}});}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00308}00308\ }
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00309}00309\ \ \ \textcolor{comment}{//\ Update\ Kalman\ output\ to\ angle\ roll\ and\ uncertaintity}}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00310}00310\ \ \ *\mbox{\hyperlink{_main_8h_a695dccac97a0f45cf570237e981b2b5d}{preChargeData}}.\mbox{\hyperlink{struct_pre_charge_task_data_a53289d52f48c067285cb843ef7470c9a}{angle\_X}}\ =\ \mbox{\hyperlink{_main_8h_a695dccac97a0f45cf570237e981b2b5d}{preChargeData}}.\mbox{\hyperlink{struct_pre_charge_task_data_a4ca4aeeb66f8fa86b2b33287d78f8174}{Kalman1DOutput}}[0];}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00311}00311\ \ \ *\mbox{\hyperlink{_main_8h_a695dccac97a0f45cf570237e981b2b5d}{preChargeData}}.\mbox{\hyperlink{struct_pre_charge_task_data_a56b12f35d375a77d39a5067b35701ec6}{KalmanUncertaintyAngleRoll}}\ =\ \mbox{\hyperlink{_main_8h_a695dccac97a0f45cf570237e981b2b5d}{preChargeData}}.\mbox{\hyperlink{struct_pre_charge_task_data_a4ca4aeeb66f8fa86b2b33287d78f8174}{Kalman1DOutput}}[1];}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00312}00312\ }
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00313}00313\ \ \ \textcolor{comment}{//\ Calculate\ Pitch\ angle\ (around\ y-\/axis)}}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00314}00314\ \ \ \mbox{\hyperlink{_pre_charge_8ino_ade8f654468b951602d2622b34902944f}{kalman\_1d}}(*\mbox{\hyperlink{_main_8h_a695dccac97a0f45cf570237e981b2b5d}{preChargeData}}.\mbox{\hyperlink{struct_pre_charge_task_data_a7a48fc6887285d4cb55bff65fca23f36}{angle\_Y}},\ *\mbox{\hyperlink{_main_8h_a695dccac97a0f45cf570237e981b2b5d}{preChargeData}}.\mbox{\hyperlink{struct_pre_charge_task_data_a87db2a0a7add2863f02e490544f937b2}{KalmanUncertaintyAnglePitch}},\ *\mbox{\hyperlink{_main_8h_a695dccac97a0f45cf570237e981b2b5d}{preChargeData}}.\mbox{\hyperlink{struct_pre_charge_task_data_afc133d30f22f7a7f72ee498b3d69be82}{RatePitch}},\ *\mbox{\hyperlink{_main_8h_a695dccac97a0f45cf570237e981b2b5d}{preChargeData}}.\mbox{\hyperlink{struct_pre_charge_task_data_a4bb0f04e326928d80e286b279ca81003}{AnglePitch}},\ \mbox{\hyperlink{_main_8h_a695dccac97a0f45cf570237e981b2b5d}{preChargeData}});}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00315}00315\ }
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00316}00316\ \ \ \textcolor{comment}{//\ Update\ Kalman\ output\ to\ angle\ pitch\ and\ uncertaintity}}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00317}00317\ \ \ *\mbox{\hyperlink{_main_8h_a695dccac97a0f45cf570237e981b2b5d}{preChargeData}}.\mbox{\hyperlink{struct_pre_charge_task_data_a7a48fc6887285d4cb55bff65fca23f36}{angle\_Y}}\ =\ \mbox{\hyperlink{_main_8h_a695dccac97a0f45cf570237e981b2b5d}{preChargeData}}.\mbox{\hyperlink{struct_pre_charge_task_data_a4ca4aeeb66f8fa86b2b33287d78f8174}{Kalman1DOutput}}[0];}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00318}00318\ \ \ *\mbox{\hyperlink{_main_8h_a695dccac97a0f45cf570237e981b2b5d}{preChargeData}}.\mbox{\hyperlink{struct_pre_charge_task_data_a87db2a0a7add2863f02e490544f937b2}{KalmanUncertaintyAnglePitch}}\ =\ \mbox{\hyperlink{_main_8h_a695dccac97a0f45cf570237e981b2b5d}{preChargeData}}.\mbox{\hyperlink{struct_pre_charge_task_data_a4ca4aeeb66f8fa86b2b33287d78f8174}{Kalman1DOutput}}[1];}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00319}00319\ \}}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00320}00320\ }
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00321}\mbox{\hyperlink{_precharge_8h_ade8f654468b951602d2622b34902944f}{00321}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{_pre_charge_8ino_ade8f654468b951602d2622b34902944f}{kalman\_1d}}(\textcolor{keywordtype}{float}\ KalmanState,\ \textcolor{keywordtype}{float}\ KalmanUncertainty,\ \textcolor{keywordtype}{float}\ KalmanInput,\ \textcolor{keywordtype}{float}\ KalmanMeasurement,\ \mbox{\hyperlink{struct_pre_charge_task_data}{PreChargeTaskData}}\ \mbox{\hyperlink{_main_8h_a695dccac97a0f45cf570237e981b2b5d}{preChargeData}})\ \{}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00322}00322\ \ \ KalmanState\ =\ KalmanState\ +\ 0.004\ *\ KalmanInput;}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00323}00323\ \ \ KalmanUncertainty\ =\ KalmanUncertainty\ +\ 0.004\ *\ 0.004\ *\ 4\ *\ 4;}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00324}00324\ \ \ \textcolor{keywordtype}{float}\ KalmanGain\ =\ KalmanUncertainty\ *\ 1\ /\ (1\ *\ KalmanUncertainty\ +\ 3\ *\ 3);}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00325}00325\ \ \ KalmanState\ =\ KalmanState\ +\ KalmanGain\ *\ (KalmanMeasurement\ -\/\ KalmanState);}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00326}00326\ \ \ KalmanUncertainty\ =\ (1\ -\/\ KalmanGain)\ *\ KalmanUncertainty;}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00327}00327\ \ \ \textcolor{comment}{//\ Output\ of\ filter}}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00328}00328\ \ \ \mbox{\hyperlink{_main_8h_a695dccac97a0f45cf570237e981b2b5d}{preChargeData}}.\mbox{\hyperlink{struct_pre_charge_task_data_a4ca4aeeb66f8fa86b2b33287d78f8174}{Kalman1DOutput}}[0]\ =\ KalmanState;}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00329}00329\ \ \ \mbox{\hyperlink{_main_8h_a695dccac97a0f45cf570237e981b2b5d}{preChargeData}}.\mbox{\hyperlink{struct_pre_charge_task_data_a4ca4aeeb66f8fa86b2b33287d78f8174}{Kalman1DOutput}}[1]\ =\ KalmanUncertainty;}
\DoxyCodeLine{\Hypertarget{_pre_charge_8ino_source_l00330}00330\ \}}

\end{DoxyCode}
