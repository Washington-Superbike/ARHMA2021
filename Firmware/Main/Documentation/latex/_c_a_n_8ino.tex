\hypertarget{_c_a_n_8ino}{}\doxysection{C\+:/\+Users/ponym/\+ARHMA2021/\+Firmware/\+Main/\+CAN.ino File Reference}
\label{_c_a_n_8ino}\index{C:/Users/ponym/ARHMA2021/Firmware/Main/CAN.ino@{C:/Users/ponym/ARHMA2021/Firmware/Main/CAN.ino}}


The \mbox{\hyperlink{_c_a_n_8ino}{CAN.\+ino}} file operates the CAN bus for the bike\textquotesingle{}s firmware. This updates all the variables in the \mbox{\hyperlink{_c_a_n_8h}{CAN.\+h}} file using the various helper methods. Really simple. Just reads in the message using the CAN bus and then updates them according to the values derived from the datasheets.  


{\ttfamily \#include \char`\"{}CAN.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}Free\+RTOS\+\_\+\+TEENSY4.\+h\char`\"{}}\newline
\doxysubsection*{Functions}
\begin{DoxyCompactItemize}
\item 
void \mbox{\hyperlink{_c_a_n_8ino_a785e095da30ce4993a186804102bf2ea}{can\+Task}} (void $\ast$can\+Data)
\item 
void \mbox{\hyperlink{_c_a_n_8ino_a833ae6516ecb5cb3f8a7bd5adbf2bd9b}{setup\+CAN}} ()
\item 
void \mbox{\hyperlink{_c_a_n_8ino_acc8ad6a9a2388c904e5c2a81e263c59d}{decipher\+EVCCStats}} (CAN\+\_\+message\+\_\+t msg, \mbox{\hyperlink{struct_charge_controller_stats}{Charge\+Controller\+Stats}} evcc\+Stats)
\item 
void \mbox{\hyperlink{_c_a_n_8ino_a3e5ce0cee4895bc07047a515ac2fa8ea}{decipher\+Charger\+Stats}} (CAN\+\_\+message\+\_\+t msg, \mbox{\hyperlink{struct_charger_stats}{Charger\+Stats}} \mbox{\hyperlink{_main_8h_aa249f1d073086c27682168bbd7dc77ee}{charger\+Stats}})
\item 
void \mbox{\hyperlink{_c_a_n_8ino_abd98b0e43fb7330bf8964d8da390810f}{decode\+Motor\+Stats}} (CAN\+\_\+message\+\_\+t msg, \mbox{\hyperlink{struct_motor_stats}{Motor\+Stats}} \mbox{\hyperlink{_main_8h_a9eeb128a9907154869e9ffa78e065039}{motor\+Stats}})
\item 
void \mbox{\hyperlink{_c_a_n_8ino_a950c51dd93e1585b49156c52113ab832}{decode\+Motor\+Temps}} (CAN\+\_\+message\+\_\+t msg, \mbox{\hyperlink{struct_motor_temps}{Motor\+Temps}} \mbox{\hyperlink{_main_8h_abb61c6dc61d12b31aad7bdadd495b70a}{motor\+Temps}})
\item 
void \mbox{\hyperlink{_c_a_n_8ino_ac7f58797b08a603835f0488b5fe3fb7c}{decipher\+BMSStatus}} (CAN\+\_\+message\+\_\+t msg, \mbox{\hyperlink{struct_b_m_s_status}{BMSStatus}} \mbox{\hyperlink{_main_8h_ae0522609134711f92c96ffa8ed05e582}{bms\+Status}})
\item 
void \mbox{\hyperlink{_c_a_n_8ino_ac7f0128ba5279b58ce4917ff6d80264e}{decipher\+Cells\+Voltage}} (CAN\+\_\+message\+\_\+t msg, \mbox{\hyperlink{struct_cell_voltages}{Cell\+Voltages}} \mbox{\hyperlink{_main_8h_afca6798677cebeeb7599ea00e1e243dd}{cell\+Voltages}})
\item 
void \mbox{\hyperlink{_c_a_n_8ino_a11cd027f4ad6ca2a6b9a860a07fb8e41}{decipher\+Thermistors}} (CAN\+\_\+message\+\_\+t msg, \mbox{\hyperlink{struct_thermistor_temps}{Thermistor\+Temps}} \mbox{\hyperlink{_main_8h_a18571448b101f12a60457d717dc4f953}{thermistor\+Temps}})
\item 
void \mbox{\hyperlink{_c_a_n_8ino_afd1fb5329197c4478969008e0ee42f90}{calculate\+Series\+Voltage}} (\mbox{\hyperlink{struct_cell_voltages}{Cell\+Voltages}} cell\+Vs)
\item 
void \mbox{\hyperlink{_c_a_n_8ino_ab92f5f7e74cba4411e9f1c6f32a720a5}{check\+CAN}} (\mbox{\hyperlink{struct_c_a_n_task_data}{CANTask\+Data}} can\+Data)
\item 
void \mbox{\hyperlink{_c_a_n_8ino_a317708f05ea5de4b748e27c49e2a85e8}{print\+BMSStatus}} ()
\item 
void \mbox{\hyperlink{_c_a_n_8ino_ad899aaa07def0c8757bea6e9a75f878d}{print\+Message}} (CAN\+\_\+message\+\_\+t msg)
\item 
void \mbox{\hyperlink{_c_a_n_8ino_a0953b2f37f0e637d3f5fba2148109d2a}{request\+Cell\+Voltages}} (int LTC)
\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}
The \mbox{\hyperlink{_c_a_n_8ino}{CAN.\+ino}} file operates the CAN bus for the bike\textquotesingle{}s firmware. This updates all the variables in the \mbox{\hyperlink{_c_a_n_8h}{CAN.\+h}} file using the various helper methods. Really simple. Just reads in the message using the CAN bus and then updates them according to the values derived from the datasheets. 

\begin{DoxyAuthor}{Author}
Washington Superbike 
\end{DoxyAuthor}
\begin{DoxyDate}{Date}
1-\/March-\/2023 
\end{DoxyDate}
\begin{DoxyNote}{Note}
Dont mess with this too much. It\textquotesingle{}s great.
\end{DoxyNote}
\begin{DoxyRefDesc}{Todo}
\item[\mbox{\hyperlink{todo__todo000002}{Todo}}]Change the \char`\"{}if CAN\+\_\+\+NODES != 0\char`\"{} to be an ifndef statement in the start. That means the check\+CAN and request\+Cell\+Voltages lines will not execute unless CAN\+\_\+\+NODES is a non-\/zero number in \mbox{\hyperlink{_main_8h}{Main.\+h}} before compiling. ~\newline
 ~\newline
 Potentially, check if the data is actually being updated by HIL. There is no real instantiation of associating the CAN variables with the messages being read in in the \mbox{\hyperlink{_c_a_n_8ino_a785e095da30ce4993a186804102bf2ea}{can\+Task()}}, so maybe call on those methods to read in those values, in case it doesnt work. ~\newline
 ~\newline
 Goal 3. ~\newline
 ~\newline
 Final Goal. \end{DoxyRefDesc}


Definition in file \mbox{\hyperlink{_c_a_n_8ino_source}{CAN.\+ino}}.



\doxysubsection{Function Documentation}
\mbox{\Hypertarget{_c_a_n_8ino_afd1fb5329197c4478969008e0ee42f90}\label{_c_a_n_8ino_afd1fb5329197c4478969008e0ee42f90}} 
\index{CAN.ino@{CAN.ino}!calculateSeriesVoltage@{calculateSeriesVoltage}}
\index{calculateSeriesVoltage@{calculateSeriesVoltage}!CAN.ino@{CAN.ino}}
\doxysubsubsection{\texorpdfstring{calculateSeriesVoltage()}{calculateSeriesVoltage()}}
{\footnotesize\ttfamily void calculate\+Series\+Voltage (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{struct_cell_voltages}{Cell\+Voltages}}}]{cell\+Vs }\end{DoxyParamCaption})}



Definition at line \mbox{\hyperlink{_c_a_n_8ino_source_l00135}{135}} of file \mbox{\hyperlink{_c_a_n_8ino_source}{CAN.\+ino}}.

\mbox{\Hypertarget{_c_a_n_8ino_a785e095da30ce4993a186804102bf2ea}\label{_c_a_n_8ino_a785e095da30ce4993a186804102bf2ea}} 
\index{CAN.ino@{CAN.ino}!canTask@{canTask}}
\index{canTask@{canTask}!CAN.ino@{CAN.ino}}
\doxysubsubsection{\texorpdfstring{canTask()}{canTask()}}
{\footnotesize\ttfamily void can\+Task (\begin{DoxyParamCaption}\item[{void $\ast$}]{can\+Data }\end{DoxyParamCaption})}

First \mbox{\hyperlink{_c_a_n_8ino_a785e095da30ce4993a186804102bf2ea}{can\+Task()}} checks for new incoming messages

NOTE\+: CAN breaks if we try sending messages with 0 other nodes on the bus as there is no node to \textquotesingle{}ACK\textquotesingle{} our message. Therefore, change CAN\+\_\+\+NODES in \mbox{\hyperlink{_main_8h}{Main.\+h}} to make sure things dont break.

Ask for other half of cell voltages from BMS every 2 seconds

Definition at line \mbox{\hyperlink{_c_a_n_8ino_source_l00031}{31}} of file \mbox{\hyperlink{_c_a_n_8ino_source}{CAN.\+ino}}.

\mbox{\Hypertarget{_c_a_n_8ino_ab92f5f7e74cba4411e9f1c6f32a720a5}\label{_c_a_n_8ino_ab92f5f7e74cba4411e9f1c6f32a720a5}} 
\index{CAN.ino@{CAN.ino}!checkCAN@{checkCAN}}
\index{checkCAN@{checkCAN}!CAN.ino@{CAN.ino}}
\doxysubsubsection{\texorpdfstring{checkCAN()}{checkCAN()}}
{\footnotesize\ttfamily void check\+CAN (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{struct_c_a_n_task_data}{CANTask\+Data}}}]{can\+Data }\end{DoxyParamCaption})}



Definition at line \mbox{\hyperlink{_c_a_n_8ino_source_l00145}{145}} of file \mbox{\hyperlink{_c_a_n_8ino_source}{CAN.\+ino}}.

\mbox{\Hypertarget{_c_a_n_8ino_ac7f58797b08a603835f0488b5fe3fb7c}\label{_c_a_n_8ino_ac7f58797b08a603835f0488b5fe3fb7c}} 
\index{CAN.ino@{CAN.ino}!decipherBMSStatus@{decipherBMSStatus}}
\index{decipherBMSStatus@{decipherBMSStatus}!CAN.ino@{CAN.ino}}
\doxysubsubsection{\texorpdfstring{decipherBMSStatus()}{decipherBMSStatus()}}
{\footnotesize\ttfamily void decipher\+BMSStatus (\begin{DoxyParamCaption}\item[{CAN\+\_\+message\+\_\+t}]{msg,  }\item[{\mbox{\hyperlink{struct_b_m_s_status}{BMSStatus}}}]{bms\+Status }\end{DoxyParamCaption})}



Definition at line \mbox{\hyperlink{_c_a_n_8ino_source_l00088}{88}} of file \mbox{\hyperlink{_c_a_n_8ino_source}{CAN.\+ino}}.

\mbox{\Hypertarget{_c_a_n_8ino_ac7f0128ba5279b58ce4917ff6d80264e}\label{_c_a_n_8ino_ac7f0128ba5279b58ce4917ff6d80264e}} 
\index{CAN.ino@{CAN.ino}!decipherCellsVoltage@{decipherCellsVoltage}}
\index{decipherCellsVoltage@{decipherCellsVoltage}!CAN.ino@{CAN.ino}}
\doxysubsubsection{\texorpdfstring{decipherCellsVoltage()}{decipherCellsVoltage()}}
{\footnotesize\ttfamily void decipher\+Cells\+Voltage (\begin{DoxyParamCaption}\item[{CAN\+\_\+message\+\_\+t}]{msg,  }\item[{\mbox{\hyperlink{struct_cell_voltages}{Cell\+Voltages}}}]{cell\+Voltages }\end{DoxyParamCaption})}



Definition at line \mbox{\hyperlink{_c_a_n_8ino_source_l00096}{96}} of file \mbox{\hyperlink{_c_a_n_8ino_source}{CAN.\+ino}}.

\mbox{\Hypertarget{_c_a_n_8ino_a3e5ce0cee4895bc07047a515ac2fa8ea}\label{_c_a_n_8ino_a3e5ce0cee4895bc07047a515ac2fa8ea}} 
\index{CAN.ino@{CAN.ino}!decipherChargerStats@{decipherChargerStats}}
\index{decipherChargerStats@{decipherChargerStats}!CAN.ino@{CAN.ino}}
\doxysubsubsection{\texorpdfstring{decipherChargerStats()}{decipherChargerStats()}}
{\footnotesize\ttfamily void decipher\+Charger\+Stats (\begin{DoxyParamCaption}\item[{CAN\+\_\+message\+\_\+t}]{msg,  }\item[{\mbox{\hyperlink{struct_charger_stats}{Charger\+Stats}}}]{charger\+Stats }\end{DoxyParamCaption})}



Definition at line \mbox{\hyperlink{_c_a_n_8ino_source_l00066}{66}} of file \mbox{\hyperlink{_c_a_n_8ino_source}{CAN.\+ino}}.

\mbox{\Hypertarget{_c_a_n_8ino_acc8ad6a9a2388c904e5c2a81e263c59d}\label{_c_a_n_8ino_acc8ad6a9a2388c904e5c2a81e263c59d}} 
\index{CAN.ino@{CAN.ino}!decipherEVCCStats@{decipherEVCCStats}}
\index{decipherEVCCStats@{decipherEVCCStats}!CAN.ino@{CAN.ino}}
\doxysubsubsection{\texorpdfstring{decipherEVCCStats()}{decipherEVCCStats()}}
{\footnotesize\ttfamily void decipher\+EVCCStats (\begin{DoxyParamCaption}\item[{CAN\+\_\+message\+\_\+t}]{msg,  }\item[{\mbox{\hyperlink{struct_charge_controller_stats}{Charge\+Controller\+Stats}}}]{evcc\+Stats }\end{DoxyParamCaption})}



Definition at line \mbox{\hyperlink{_c_a_n_8ino_source_l00060}{60}} of file \mbox{\hyperlink{_c_a_n_8ino_source}{CAN.\+ino}}.

\mbox{\Hypertarget{_c_a_n_8ino_a11cd027f4ad6ca2a6b9a860a07fb8e41}\label{_c_a_n_8ino_a11cd027f4ad6ca2a6b9a860a07fb8e41}} 
\index{CAN.ino@{CAN.ino}!decipherThermistors@{decipherThermistors}}
\index{decipherThermistors@{decipherThermistors}!CAN.ino@{CAN.ino}}
\doxysubsubsection{\texorpdfstring{decipherThermistors()}{decipherThermistors()}}
{\footnotesize\ttfamily void decipher\+Thermistors (\begin{DoxyParamCaption}\item[{CAN\+\_\+message\+\_\+t}]{msg,  }\item[{\mbox{\hyperlink{struct_thermistor_temps}{Thermistor\+Temps}}}]{thermistor\+Temps }\end{DoxyParamCaption})}



Definition at line \mbox{\hyperlink{_c_a_n_8ino_source_l00123}{123}} of file \mbox{\hyperlink{_c_a_n_8ino_source}{CAN.\+ino}}.

\mbox{\Hypertarget{_c_a_n_8ino_abd98b0e43fb7330bf8964d8da390810f}\label{_c_a_n_8ino_abd98b0e43fb7330bf8964d8da390810f}} 
\index{CAN.ino@{CAN.ino}!decodeMotorStats@{decodeMotorStats}}
\index{decodeMotorStats@{decodeMotorStats}!CAN.ino@{CAN.ino}}
\doxysubsubsection{\texorpdfstring{decodeMotorStats()}{decodeMotorStats()}}
{\footnotesize\ttfamily void decode\+Motor\+Stats (\begin{DoxyParamCaption}\item[{CAN\+\_\+message\+\_\+t}]{msg,  }\item[{\mbox{\hyperlink{struct_motor_stats}{Motor\+Stats}}}]{motor\+Stats }\end{DoxyParamCaption})}



Definition at line \mbox{\hyperlink{_c_a_n_8ino_source_l00074}{74}} of file \mbox{\hyperlink{_c_a_n_8ino_source}{CAN.\+ino}}.

\mbox{\Hypertarget{_c_a_n_8ino_a950c51dd93e1585b49156c52113ab832}\label{_c_a_n_8ino_a950c51dd93e1585b49156c52113ab832}} 
\index{CAN.ino@{CAN.ino}!decodeMotorTemps@{decodeMotorTemps}}
\index{decodeMotorTemps@{decodeMotorTemps}!CAN.ino@{CAN.ino}}
\doxysubsubsection{\texorpdfstring{decodeMotorTemps()}{decodeMotorTemps()}}
{\footnotesize\ttfamily void decode\+Motor\+Temps (\begin{DoxyParamCaption}\item[{CAN\+\_\+message\+\_\+t}]{msg,  }\item[{\mbox{\hyperlink{struct_motor_temps}{Motor\+Temps}}}]{motor\+Temps }\end{DoxyParamCaption})}



Definition at line \mbox{\hyperlink{_c_a_n_8ino_source_l00081}{81}} of file \mbox{\hyperlink{_c_a_n_8ino_source}{CAN.\+ino}}.

\mbox{\Hypertarget{_c_a_n_8ino_a317708f05ea5de4b748e27c49e2a85e8}\label{_c_a_n_8ino_a317708f05ea5de4b748e27c49e2a85e8}} 
\index{CAN.ino@{CAN.ino}!printBMSStatus@{printBMSStatus}}
\index{printBMSStatus@{printBMSStatus}!CAN.ino@{CAN.ino}}
\doxysubsubsection{\texorpdfstring{printBMSStatus()}{printBMSStatus()}}
{\footnotesize\ttfamily void print\+BMSStatus (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}



Definition at line \mbox{\hyperlink{_c_a_n_8ino_source_l00190}{190}} of file \mbox{\hyperlink{_c_a_n_8ino_source}{CAN.\+ino}}.

\mbox{\Hypertarget{_c_a_n_8ino_ad899aaa07def0c8757bea6e9a75f878d}\label{_c_a_n_8ino_ad899aaa07def0c8757bea6e9a75f878d}} 
\index{CAN.ino@{CAN.ino}!printMessage@{printMessage}}
\index{printMessage@{printMessage}!CAN.ino@{CAN.ino}}
\doxysubsubsection{\texorpdfstring{printMessage()}{printMessage()}}
{\footnotesize\ttfamily void print\+Message (\begin{DoxyParamCaption}\item[{CAN\+\_\+message\+\_\+t}]{msg }\end{DoxyParamCaption})}



Definition at line \mbox{\hyperlink{_c_a_n_8ino_source_l00224}{224}} of file \mbox{\hyperlink{_c_a_n_8ino_source}{CAN.\+ino}}.

\mbox{\Hypertarget{_c_a_n_8ino_a0953b2f37f0e637d3f5fba2148109d2a}\label{_c_a_n_8ino_a0953b2f37f0e637d3f5fba2148109d2a}} 
\index{CAN.ino@{CAN.ino}!requestCellVoltages@{requestCellVoltages}}
\index{requestCellVoltages@{requestCellVoltages}!CAN.ino@{CAN.ino}}
\doxysubsubsection{\texorpdfstring{requestCellVoltages()}{requestCellVoltages()}}
{\footnotesize\ttfamily void request\+Cell\+Voltages (\begin{DoxyParamCaption}\item[{int}]{LTC }\end{DoxyParamCaption})}



Definition at line \mbox{\hyperlink{_c_a_n_8ino_source_l00234}{234}} of file \mbox{\hyperlink{_c_a_n_8ino_source}{CAN.\+ino}}.

\mbox{\Hypertarget{_c_a_n_8ino_a833ae6516ecb5cb3f8a7bd5adbf2bd9b}\label{_c_a_n_8ino_a833ae6516ecb5cb3f8a7bd5adbf2bd9b}} 
\index{CAN.ino@{CAN.ino}!setupCAN@{setupCAN}}
\index{setupCAN@{setupCAN}!CAN.ino@{CAN.ino}}
\doxysubsubsection{\texorpdfstring{setupCAN()}{setupCAN()}}
{\footnotesize\ttfamily void setup\+CAN (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}



Definition at line \mbox{\hyperlink{_c_a_n_8ino_source_l00055}{55}} of file \mbox{\hyperlink{_c_a_n_8ino_source}{CAN.\+ino}}.

