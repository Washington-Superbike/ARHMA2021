<?xml version='1.0' encoding='UTF-8' standalone='no'?>
<section xmlns="http://docbook.org/ns/docbook" version="5.0" xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="__main_8ino_source" xml:lang="en-US">
<title>C:/Users/ponym/ARHMA2021/Firmware/Main/Main.ino</title>
Go to the documentation of this file.<programlisting linenumbering="unnumbered"><anchor xml:id="__main_8ino_source_1l00001"/>00001 
<anchor xml:id="__main_8ino_source_1l00062"/>00062 <emphasis role="comment">//&#32;Includes&#32;the&#32;Main.h&#32;file&#32;which&#32;in&#32;includes&#32;all&#32;other&#32;files&#32;and&#32;interconnects&#32;all&#32;other&#32;files&#32;together.</emphasis>
<anchor xml:id="__main_8ino_source_1l00063"/>00063 <emphasis role="preprocessor">#include&#32;&quot;<link linkend="__main_8h">Main.h</link>&quot;</emphasis>
<anchor xml:id="__main_8ino_source_1l00064"/>00064 
<anchor xml:id="__main_8ino_source_1l00065"/><link linkend="__main_8h_1a4fc01d736fe50cf5b977f755b675f11d">00065</link> <emphasis role="keywordtype">void</emphasis>&#32;<link linkend="__main_8ino_1a4fc01d736fe50cf5b977f755b675f11d">setup</link>()&#32;{
<anchor xml:id="__main_8ino_source_1l00066"/>00066 
<anchor xml:id="__main_8ino_source_1l00069"/>00069 &#32;&#32;<link linkend="__main_8ino_1a31d554847ae8fdeaba2460e0395cb75f">setupPins</link>();
<anchor xml:id="__main_8ino_source_1l00070"/>00070 
<anchor xml:id="__main_8ino_source_1l00073"/>00073 &#32;&#32;<link linkend="__main_8ino_1a128d10ba9e06eb69d1dfc91ffef935ba">initializeDisplayStructs</link>();
<anchor xml:id="__main_8ino_source_1l00076"/>00076 &#32;&#32;<link linkend="__main_8ino_1ab91267714bdf99d7b3d177f95f484157">initializeCANStructs</link>();
<anchor xml:id="__main_8ino_source_1l00079"/>00079 &#32;&#32;<link linkend="__main_8ino_1a797cf3c70ce7ae02bba9bfd3f6d886de">initializeLogStructs</link>();
<anchor xml:id="__main_8ino_source_1l00082"/>00082 &#32;&#32;<link linkend="__main_8ino_1a32469c898d757b2b30c00d0546f91802">initializePreChargeStruct</link>();
<anchor xml:id="__main_8ino_source_1l00083"/>00083 
<anchor xml:id="__main_8ino_source_1l00084"/>00084 
<anchor xml:id="__main_8ino_source_1l00087"/>00087 &#32;&#32;Serial.begin(115200);
<anchor xml:id="__main_8ino_source_1l00088"/>00088 
<anchor xml:id="__main_8ino_source_1l00100"/>00100 &#32;&#32;setTime(Teensy3Clock.get());
<anchor xml:id="__main_8ino_source_1l00101"/>00101 
<anchor xml:id="__main_8ino_source_1l00103"/>00103 &#32;&#32;Serial.print(<emphasis role="stringliteral">&quot;Starting&#32;SD:&#32;&quot;</emphasis>);
<anchor xml:id="__main_8ino_source_1l00104"/>00104 &#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(<link linkend="__data_logging_8h_1a0d2a3a213399ec010b89dede4ba4de77">startSD</link>())&#32;{
<anchor xml:id="__main_8ino_source_1l00105"/>00105 &#32;&#32;&#32;&#32;Serial.println(<emphasis role="stringliteral">&quot;SD&#32;successfully&#32;started&quot;</emphasis>);
<anchor xml:id="__main_8ino_source_1l00106"/>00106 &#32;&#32;&#32;&#32;<link linkend="__main_8h_1acdca7f14bb24f1cb2aa9d0be982560b2">sdStarted</link>&#32;=&#32;1;
<anchor xml:id="__main_8ino_source_1l00107"/>00107 &#32;&#32;}&#32;<emphasis role="keywordflow">else</emphasis>&#32;{
<anchor xml:id="__main_8ino_source_1l00108"/>00108 &#32;&#32;&#32;&#32;<link linkend="__main_8h_1acdca7f14bb24f1cb2aa9d0be982560b2">sdStarted</link>&#32;=&#32;0;
<anchor xml:id="__main_8ino_source_1l00109"/>00109 &#32;&#32;&#32;&#32;Serial.println(<emphasis role="stringliteral">&quot;Error&#32;starting&#32;SD&#32;card&quot;</emphasis>);
<anchor xml:id="__main_8ino_source_1l00110"/>00110 &#32;&#32;}
<anchor xml:id="__main_8ino_source_1l00111"/>00111 
<anchor xml:id="__main_8ino_source_1l00114"/>00114 &#32;&#32;<link linkend="__display_8h_1a79b84de3ddc4f88db07ac708452e4467">setupDisplay</link>(<link linkend="__main_8h_1a962a20f8dc1ba6934fdc04e44bde53a8">measurementData</link>);
<anchor xml:id="__main_8ino_source_1l00115"/>00115 
<anchor xml:id="__main_8ino_source_1l00118"/>00118 &#32;&#32;<link linkend="__c_a_n_8h_1a833ae6516ecb5cb3f8a7bd5adbf2bd9b">setupCAN</link>();
<anchor xml:id="__main_8ino_source_1l00119"/>00119 
<anchor xml:id="__main_8ino_source_1l00123"/>00123 &#32;&#32;<link linkend="__precharge_8h_1a5782bd590f95fb2269eb43a3d70c18f4">setupI2C</link>(<link linkend="__main_8h_1a695dccac97a0f45cf570237e981b2b5d">preChargeData</link>);
<anchor xml:id="__main_8ino_source_1l00124"/>00124 
<anchor xml:id="__main_8ino_source_1l00125"/>00125 &#32;&#32;<emphasis role="comment">//&#32;unused&#32;but&#32;left&#32;as&#32;a&#32;reminder&#32;for&#32;how&#32;you&#32;can&#32;use&#32;it</emphasis>
<anchor xml:id="__main_8ino_source_1l00126"/>00126 &#32;&#32;<link linkend="__main_8h_1a76c0525d646735793add25b18043e600">spi_mutex</link>&#32;=&#32;xSemaphoreCreateMutex();
<anchor xml:id="__main_8ino_source_1l00127"/>00127 
<anchor xml:id="__main_8ino_source_1l00137"/>00137 
<anchor xml:id="__main_8ino_source_1l00138"/>00138 &#32;&#32;<link linkend="_portmacro_8h_1a1ebe82d24d764ae4e352f7c3a9f92c01">portBASE_TYPE</link>&#32;s1,&#32;s2,&#32;s3,&#32;s4,&#32;s5;
<anchor xml:id="__main_8ino_source_1l00139"/>00139 &#32;&#32;s1&#32;=&#32;<link linkend="_tasks_8c_1ad138d9dda4709b10d711775fa40eb1a1">xTaskCreate</link>(<link linkend="__pre_charge_8ino_1a2cd6f5c27d7667dbd0b6a0bc756340a3">prechargeTask</link>,&#32;<emphasis role="stringliteral">&quot;PRECHARGE&#32;TASK&quot;</emphasis>,&#32;<link linkend="__precharge_8h_1a0ea5dd53294d533feaeeb8731cb9739a">PRECHARGE_TASK_STACK_SIZE</link>,&#32;(<emphasis role="keywordtype">void</emphasis>&#32;*)&amp;<link linkend="__main_8h_1a695dccac97a0f45cf570237e981b2b5d">preChargeData</link>,&#32;5,&#32;NULL);
<anchor xml:id="__main_8ino_source_1l00140"/>00140 &#32;&#32;<emphasis role="comment">//&#32;make&#32;sure&#32;to&#32;set&#32;CAN_NODES&#32;in&#32;config.h</emphasis>
<anchor xml:id="__main_8ino_source_1l00141"/>00141 &#32;&#32;s2&#32;=&#32;<link linkend="_tasks_8c_1ad138d9dda4709b10d711775fa40eb1a1">xTaskCreate</link>(<link linkend="__c_a_n_8h_1a785e095da30ce4993a186804102bf2ea">canTask</link>,&#32;<emphasis role="stringliteral">&quot;CAN&#32;TASK&quot;</emphasis>,&#32;<link linkend="__c_a_n_8h_1ab9d0930315055c0f1a6511c6cc3c5524">CAN_TASK_STACK_SIZE</link>,&#32;(<emphasis role="keywordtype">void</emphasis>&#32;*)&amp;<link linkend="__main_8h_1ab1d006bdd632ad57598689186c8ce63a">canTaskData</link>,&#32;4,&#32;NULL);
<anchor xml:id="__main_8ino_source_1l00142"/>00142 &#32;&#32;s3&#32;=&#32;<link linkend="_tasks_8c_1ad138d9dda4709b10d711775fa40eb1a1">xTaskCreate</link>(<link linkend="__main_8ino_1a0d7297755c0775a9b0e4f7eeeafd7c7e">idleTask</link>,&#32;<emphasis role="stringliteral">&quot;IDLE_TASK&quot;</emphasis>,&#32;<link linkend="__free_r_t_o_s_config__default_8h_1a6c534a6cf8a00528fe0be42083484f9a">configMINIMAL_STACK_SIZE</link>,&#32;NULL,&#32;1,&#32;NULL);
<anchor xml:id="__main_8ino_source_1l00143"/>00143 &#32;&#32;s4&#32;=&#32;<link linkend="_tasks_8c_1ad138d9dda4709b10d711775fa40eb1a1">xTaskCreate</link>(<link linkend="__display_8ino_1a7121972a969d5d8bd9c96626cfd61b11">displayTask</link>,&#32;<emphasis role="stringliteral">&quot;DISPLAY&#32;TASK&quot;</emphasis>,&#32;<link linkend="__display_8h_1ac018fe3f2622c6da250fdcc3d1df54f2">DISPLAY_TASK_STACK_SIZE</link>,&#32;(<emphasis role="keywordtype">void</emphasis>*)&amp;<link linkend="__main_8h_1a962a20f8dc1ba6934fdc04e44bde53a8">measurementData</link>,&#32;2,&#32;NULL);
<anchor xml:id="__main_8ino_source_1l00144"/>00144 &#32;&#32;s5&#32;=&#32;<link linkend="_tasks_8c_1ad138d9dda4709b10d711775fa40eb1a1">xTaskCreate</link>(<link linkend="__data_logging_8h_1a24f7ab7e53619e5770ad9acc25b9b819">dataLoggingTask</link>,&#32;<emphasis role="stringliteral">&quot;DATA&#32;LOGGING&#32;TASK&quot;</emphasis>,&#32;<link linkend="__data_logging_8h_1af4a74cae27161ee93cd63ef70a0082e2">DATALOGGING_TASK_STACK_SIZE</link>,&#32;(<emphasis role="keywordtype">void</emphasis>*)&amp;<link linkend="__main_8h_1af74b66e7d389be76470292071c65f556">dataLoggingTaskData</link>,&#32;3,&#32;NULL);
<anchor xml:id="__main_8ino_source_1l00145"/>00145 
<anchor xml:id="__main_8ino_source_1l00148"/>00148 &#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(s1&#32;!=&#32;<link linkend="_projdefs_8h_1a07848d3078849bd32353c69d30a479b3">pdPASS</link>&#32;||&#32;s2&#32;!=&#32;<link linkend="_projdefs_8h_1a07848d3078849bd32353c69d30a479b3">pdPASS</link>&#32;||&#32;s3&#32;!=&#32;<link linkend="_projdefs_8h_1a07848d3078849bd32353c69d30a479b3">pdPASS</link>&#32;||&#32;s4&#32;!=&#32;<link linkend="_projdefs_8h_1a07848d3078849bd32353c69d30a479b3">pdPASS</link>&#32;||&#32;s5&#32;!=&#32;<link linkend="_projdefs_8h_1a07848d3078849bd32353c69d30a479b3">pdPASS</link>)&#32;{
<anchor xml:id="__main_8ino_source_1l00149"/>00149 &#32;&#32;&#32;&#32;Serial.println(<emphasis role="stringliteral">&quot;Error&#32;creating&#32;tasks&quot;</emphasis>);
<anchor xml:id="__main_8ino_source_1l00150"/>00150 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">while</emphasis>&#32;(1);
<anchor xml:id="__main_8ino_source_1l00151"/>00151 &#32;&#32;}
<anchor xml:id="__main_8ino_source_1l00152"/>00152 
<anchor xml:id="__main_8ino_source_1l00155"/>00155 &#32;&#32;Serial.println(<emphasis role="stringliteral">&quot;Starting&#32;the&#32;scheduler&quot;</emphasis>);
<anchor xml:id="__main_8ino_source_1l00156"/>00156 &#32;&#32;<link linkend="_task_8h_1aaf9dca1065c60abdeb309d56ab7293cb">vTaskStartScheduler</link>();
<anchor xml:id="__main_8ino_source_1l00157"/>00157 
<anchor xml:id="__main_8ino_source_1l00159"/>00159 &#32;&#32;Serial.println(<emphasis role="stringliteral">&quot;Insufficient&#32;RAM&quot;</emphasis>);
<anchor xml:id="__main_8ino_source_1l00160"/>00160 }
<anchor xml:id="__main_8ino_source_1l00161"/>00161 
<anchor xml:id="__main_8ino_source_1l00162"/><link linkend="__main_8h_1a31d554847ae8fdeaba2460e0395cb75f">00162</link> <emphasis role="keywordtype">void</emphasis>&#32;<link linkend="__main_8ino_1a31d554847ae8fdeaba2460e0395cb75f">setupPins</link>()&#32;{
<anchor xml:id="__main_8ino_source_1l00166"/>00166 
<anchor xml:id="__main_8ino_source_1l00168"/>00168 &#32;&#32;pinMode(<link linkend="__precharge_8h_1a4e1dc017df18faad4234012c3e88d2f6">HIGH_VOLTAGE_TOGGLE</link>,&#32;INPUT_PULLUP);
<anchor xml:id="__main_8ino_source_1l00170"/>00170 &#32;&#32;pinMode(<link linkend="__precharge_8h_1a6f82f95bb8a6ffac8f6998ff4e5e16ec">CLOSE_CONTACTOR_BUTTON</link>,&#32;INPUT_PULLUP);
<anchor xml:id="__main_8ino_source_1l00172"/>00172 &#32;&#32;pinMode(<link linkend="__display_8h_1ab40e9918d9141415a47e2a979292309c">TFT_RST</link>,&#32;OUTPUT);
<anchor xml:id="__main_8ino_source_1l00173"/>00173 &#32;&#32;digitalWrite(<link linkend="__display_8h_1ab40e9918d9141415a47e2a979292309c">TFT_RST</link>,&#32;HIGH);
<anchor xml:id="__main_8ino_source_1l00175"/>00175 &#32;&#32;pinMode(<link linkend="__display_8h_1a5f4d46ae101b77df78010c506601c87c">TFT_CS</link>,&#32;OUTPUT);
<anchor xml:id="__main_8ino_source_1l00176"/>00176 &#32;&#32;digitalWrite(<link linkend="__display_8h_1a5f4d46ae101b77df78010c506601c87c">TFT_CS</link>,&#32;HIGH);
<anchor xml:id="__main_8ino_source_1l00177"/>00177 
<anchor xml:id="__main_8ino_source_1l00179"/>00179 &#32;&#32;pinMode(<link linkend="__display_8h_1aebc2813ad338ac596f3108382916b482">TS_CS</link>,&#32;OUTPUT);
<anchor xml:id="__main_8ino_source_1l00180"/>00180 &#32;&#32;digitalWrite(<link linkend="__display_8h_1aebc2813ad338ac596f3108382916b482">TS_CS</link>,&#32;HIGH);
<anchor xml:id="__main_8ino_source_1l00181"/>00181 
<anchor xml:id="__main_8ino_source_1l00183"/>00183 &#32;&#32;pinMode(<link linkend="__precharge_8h_1a093dd273c900bae9cba2b32149e30eaa">PRECHARGE</link>,&#32;OUTPUT);
<anchor xml:id="__main_8ino_source_1l00184"/>00184 &#32;&#32;digitalWrite(<link linkend="__precharge_8h_1a093dd273c900bae9cba2b32149e30eaa">PRECHARGE</link>,&#32;LOW);
<anchor xml:id="__main_8ino_source_1l00186"/>00186 &#32;&#32;pinMode(<link linkend="__precharge_8h_1ae1099ac76283225ff2bbbbdc0819ba4e">CONTACTOR</link>,&#32;OUTPUT);
<anchor xml:id="__main_8ino_source_1l00187"/>00187 &#32;&#32;digitalWrite(<link linkend="__precharge_8h_1ae1099ac76283225ff2bbbbdc0819ba4e">CONTACTOR</link>,&#32;LOW);
<anchor xml:id="__main_8ino_source_1l00188"/>00188 
<anchor xml:id="__main_8ino_source_1l00191"/>00191 &#32;&#32;pinMode(<link linkend="__precharge_8h_1a0985e25d7f0cd7e7101c2f20c1cf8e02">CONTACTOR_PRECHARGED_LED</link>,&#32;OUTPUT);
<anchor xml:id="__main_8ino_source_1l00192"/>00192 &#32;&#32;digitalWrite(<link linkend="__precharge_8h_1a0985e25d7f0cd7e7101c2f20c1cf8e02">CONTACTOR_PRECHARGED_LED</link>,&#32;LOW);
<anchor xml:id="__main_8ino_source_1l00193"/>00193 
<anchor xml:id="__main_8ino_source_1l00195"/>00195 &#32;&#32;pinMode(<link linkend="__precharge_8h_1a606b28f262c8b6842a36e2f68cfc327a">CONTACTOR_CLOSED_LED</link>,&#32;OUTPUT);
<anchor xml:id="__main_8ino_source_1l00196"/>00196 &#32;&#32;digitalWrite(<link linkend="__precharge_8h_1a606b28f262c8b6842a36e2f68cfc327a">CONTACTOR_CLOSED_LED</link>,&#32;LOW);
<anchor xml:id="__main_8ino_source_1l00197"/>00197 }
<anchor xml:id="__main_8ino_source_1l00198"/>00198 
<anchor xml:id="__main_8ino_source_1l00199"/><link linkend="__main_8h_1a128d10ba9e06eb69d1dfc91ffef935ba">00199</link> <emphasis role="keywordtype">void</emphasis>&#32;<link linkend="__main_8ino_1a128d10ba9e06eb69d1dfc91ffef935ba">initializeDisplayStructs</link>()&#32;{
<anchor xml:id="__main_8ino_source_1l00200"/>00200 &#32;&#32;<link linkend="__main_8h_1a962a20f8dc1ba6934fdc04e44bde53a8">measurementData</link>&#32;=&#32;{
<anchor xml:id="__main_8ino_source_1l00201"/>00201 &#32;&#32;&#32;&#32;&amp;<link linkend="__main_8h_1ad2b91d0118e98c42f7d552fd5d3056ed">seriesVoltage</link>,&#32;&amp;<link linkend="__main_8h_1aca95a5d67296e1cf7fd5d05296cefc5a">motorControllerBatteryVoltage</link>,&#32;&amp;<link linkend="__main_8h_1a68edb5124f79f990fb79a9e5b7a7f1e8">auxiliaryBatteryVoltage</link>,
<anchor xml:id="__main_8ino_source_1l00202"/>00202 &#32;&#32;&#32;&#32;&amp;<link linkend="__main_8h_1ade4e42cdef2d4a9d50b3184100ad8cba">RPM</link>,&#32;&amp;<link linkend="__main_8h_1a45af45f80ded31266ad90143957a4e5e">motorControllerTemp</link>,&#32;&amp;<link linkend="__main_8h_1a7facdac5aec018a06fc1443c2f90a66d">motorCurrent</link>,&#32;&amp;<link linkend="__main_8h_1a9e20c92d5e427acd66b85b1451d23a6b">errorMessage</link>,
<anchor xml:id="__main_8ino_source_1l00203"/>00203 &#32;&#32;&#32;&#32;&amp;<link linkend="__main_8h_1a8b27b4284d9d4039618e5da068c2bc7f">chargerCurrent</link>,&#32;&amp;<link linkend="__main_8h_1ab11fffe9a473928798422de66fcde502">chargerVoltage</link>,&#32;&amp;<link linkend="__main_8h_1a04c234659b28f92e2eab7998b586bb4c">bms_status_flag</link>,&#32;&amp;<link linkend="__main_8h_1a10823f3996ecbd5481190d44baa7fd8e">evccVoltage</link>,&#32;<link linkend="__main_8h_1a283b736b2bddfc8cbec62fe0759a9cd3">thTemps</link>
<anchor xml:id="__main_8ino_source_1l00204"/>00204 &#32;&#32;};
<anchor xml:id="__main_8ino_source_1l00205"/>00205 }
<anchor xml:id="__main_8ino_source_1l00206"/>00206 
<anchor xml:id="__main_8ino_source_1l00207"/><link linkend="__main_8h_1a797cf3c70ce7ae02bba9bfd3f6d886de">00207</link> <emphasis role="keywordtype">void</emphasis>&#32;<link linkend="__main_8ino_1a797cf3c70ce7ae02bba9bfd3f6d886de">initializeLogStructs</link>()&#32;{
<anchor xml:id="__main_8ino_source_1l00208"/>00208 &#32;&#32;<link linkend="__main_8h_1a74a7fab0bce9e95dfced1f40d1764e9a">motorTemperatureLog</link>&#32;=&#32;{<link linkend="__data_logging_8h_1af00c3fd81cebf8f7797f97204750ba99">MOTOR_TEMPERATURE_LOG</link>,&#32;1,&#32;&amp;<link linkend="__main_8h_1adf4cca4e15700419969edf3ce2ffe6e6">motorTemp</link>,&#32;<link linkend="__data_logging_8h_1ac2ad7f431e3446fddcd9b6b9f93c4c14a9cf4a0866224b0bb4a7a895da27c9c4c">FLOAT</link>};
<anchor xml:id="__main_8ino_source_1l00209"/>00209 &#32;&#32;<link linkend="__main_8h_1ae230e041b8d09151f97b07151fdaf38c">motorControllerTemperatureLog</link>&#32;=&#32;{<link linkend="__data_logging_8h_1ab9b2c0322cedfd8d3cd1c9dbb513b10f">MOTOR_CONTROLLER_TEMPERATURE_LOG</link>,&#32;1,&#32;&amp;<link linkend="__main_8h_1a45af45f80ded31266ad90143957a4e5e">motorControllerTemp</link>,&#32;<link linkend="__data_logging_8h_1ac2ad7f431e3446fddcd9b6b9f93c4c14a9cf4a0866224b0bb4a7a895da27c9c4c">FLOAT</link>};
<anchor xml:id="__main_8ino_source_1l00210"/>00210 &#32;&#32;<link linkend="__main_8h_1a4ca34bc3c27d808ebe3480bfed4b997a">motorControllerVoltageLog</link>&#32;=&#32;{<link linkend="__data_logging_8h_1a34f856128abdd56434d31edd1f4ce549">MOTOR_CONTROLLER_VOLTAGE_LOG</link>,&#32;1,&#32;&amp;<link linkend="__main_8h_1aca95a5d67296e1cf7fd5d05296cefc5a">motorControllerBatteryVoltage</link>,&#32;<link linkend="__data_logging_8h_1ac2ad7f431e3446fddcd9b6b9f93c4c14a9cf4a0866224b0bb4a7a895da27c9c4c">FLOAT</link>};
<anchor xml:id="__main_8ino_source_1l00211"/>00211 &#32;&#32;<link linkend="__main_8h_1a3ed95fd1ffa6f914d3bb19bbb59d2cd0">motorCurrentLog</link>&#32;=&#32;{<link linkend="__data_logging_8h_1aa98fafae382d16d375eeef356bf55917">MOTOR_CURRENT_LOG</link>,&#32;1,&#32;&amp;<link linkend="__main_8h_1a7facdac5aec018a06fc1443c2f90a66d">motorCurrent</link>,&#32;<link linkend="__data_logging_8h_1ac2ad7f431e3446fddcd9b6b9f93c4c14a9cf4a0866224b0bb4a7a895da27c9c4c">FLOAT</link>};
<anchor xml:id="__main_8ino_source_1l00212"/>00212 &#32;&#32;<link linkend="__main_8h_1a60f914a71f12f33ed914208fbf5be838">rpmLog</link>&#32;=&#32;{<link linkend="__data_logging_8h_1af7b33dd28efa07f171323d23a5f714d2">RPM_LOG</link>,&#32;1,&#32;&amp;<link linkend="__main_8h_1ade4e42cdef2d4a9d50b3184100ad8cba">RPM</link>,&#32;<link linkend="__data_logging_8h_1ac2ad7f431e3446fddcd9b6b9f93c4c14a9cf4a0866224b0bb4a7a895da27c9c4c">FLOAT</link>};
<anchor xml:id="__main_8ino_source_1l00213"/>00213 &#32;&#32;<link linkend="__main_8h_1a8941dbd7f821806a7a6f4eb705b1472b">thermistorLog</link>&#32;=&#32;{<link linkend="__data_logging_8h_1a2665461802b5e24f2d0f9d8f1ca8351d">THERMISTOR_LOG</link>,&#32;10,&#32;&amp;<link linkend="__main_8h_1a283b736b2bddfc8cbec62fe0759a9cd3">thTemps</link>[0],&#32;<link linkend="__data_logging_8h_1ac2ad7f431e3446fddcd9b6b9f93c4c14a9cf4a0866224b0bb4a7a895da27c9c4c">FLOAT</link>};
<anchor xml:id="__main_8ino_source_1l00214"/>00214 &#32;&#32;<link linkend="__main_8h_1ade498aeeb82732f18af609faa0b323cb">bmsVoltageLog</link>&#32;=&#32;{<link linkend="__data_logging_8h_1ad345eeebe4d36d151827e130e6082a1b">BMS_VOLTAGE_LOG</link>,&#32;1,&#32;&amp;<link linkend="__main_8h_1ad2b91d0118e98c42f7d552fd5d3056ed">seriesVoltage</link>,&#32;<link linkend="__data_logging_8h_1ac2ad7f431e3446fddcd9b6b9f93c4c14a9cf4a0866224b0bb4a7a895da27c9c4c">FLOAT</link>};
<anchor xml:id="__main_8ino_source_1l00215"/>00215 &#32;&#32;<link linkend="__main_8h_1af74b66e7d389be76470292071c65f556">dataLoggingTaskData</link>&#32;=&#32;{<link linkend="__main_8h_1a9462b5ab9931c29422982609bceb3fad">logs</link>,&#32;7};
<anchor xml:id="__main_8ino_source_1l00216"/>00216 }
<anchor xml:id="__main_8ino_source_1l00217"/>00217 
<anchor xml:id="__main_8ino_source_1l00218"/><link linkend="__main_8h_1ab91267714bdf99d7b3d177f95f484157">00218</link> <emphasis role="keywordtype">void</emphasis>&#32;<link linkend="__main_8ino_1ab91267714bdf99d7b3d177f95f484157">initializeCANStructs</link>()&#32;{
<anchor xml:id="__main_8ino_source_1l00219"/>00219 &#32;&#32;<link linkend="__main_8h_1a9eeb128a9907154869e9ffa78e065039">motorStats</link>&#32;=&#32;{&amp;<link linkend="__main_8h_1ade4e42cdef2d4a9d50b3184100ad8cba">RPM</link>,&#32;&amp;<link linkend="__main_8h_1a7facdac5aec018a06fc1443c2f90a66d">motorCurrent</link>,&#32;&amp;<link linkend="__main_8h_1aca95a5d67296e1cf7fd5d05296cefc5a">motorControllerBatteryVoltage</link>,&#32;&amp;<link linkend="__main_8h_1a9e20c92d5e427acd66b85b1451d23a6b">errorMessage</link>};
<anchor xml:id="__main_8ino_source_1l00220"/>00220 &#32;&#32;<link linkend="__main_8h_1abb61c6dc61d12b31aad7bdadd495b70a">motorTemps</link>&#32;=&#32;{&amp;<link linkend="__main_8h_1adca97acc6b0ff71f782f9c8a484a47b8">throttle</link>,&#32;&amp;<link linkend="__main_8h_1a45af45f80ded31266ad90143957a4e5e">motorControllerTemp</link>,&#32;&amp;<link linkend="__main_8h_1adf4cca4e15700419969edf3ce2ffe6e6">motorTemp</link>,&#32;&amp;<link linkend="__main_8h_1ae40c5f8677bda4442f02f482f3b50d33">controllerStatus</link>};
<anchor xml:id="__main_8ino_source_1l00221"/>00221 &#32;&#32;<link linkend="__main_8h_1afca6798677cebeeb7599ea00e1e243dd">cellVoltages</link>&#32;=&#32;{&amp;<link linkend="__main_8h_1aad0824db126321851b9f0c49a3115de5">cellVoltagesArr</link>[0],&#32;&amp;<link linkend="__main_8h_1ad2b91d0118e98c42f7d552fd5d3056ed">seriesVoltage</link>,&#32;&amp;<link linkend="__main_8h_1a006c7981abf25c0944f67d017aa5fe1f">cellsReady</link>};
<anchor xml:id="__main_8ino_source_1l00222"/>00222 &#32;&#32;<link linkend="__main_8h_1ae0522609134711f92c96ffa8ed05e582">bmsStatus</link>&#32;=&#32;{&#32;&amp;<link linkend="__main_8h_1a04c234659b28f92e2eab7998b586bb4c">bms_status_flag</link>,&#32;&amp;<link linkend="__main_8h_1a54619d6c6a00d3268f764c33bd352ebf">bms_c_id</link>,&#32;&amp;<link linkend="__main_8h_1a668e87eca74f2126136ee32a6964005e">bms_c_fault</link>,&#32;&amp;<link linkend="__main_8h_1ae21e58b785392a0951862c107609d059">ltc_fault</link>,&#32;&amp;<link linkend="__main_8h_1a0de2096b0657dfd13ffeb3d18ae5d65c">ltc_count</link>};
<anchor xml:id="__main_8ino_source_1l00223"/>00223 &#32;&#32;<link linkend="__main_8h_1a18571448b101f12a60457d717dc4f953">thermistorTemps</link>&#32;=&#32;{<link linkend="__main_8h_1a283b736b2bddfc8cbec62fe0759a9cd3">thTemps</link>};
<anchor xml:id="__main_8ino_source_1l00224"/>00224 &#32;&#32;<link linkend="__main_8h_1aa249f1d073086c27682168bbd7dc77ee">chargerStats</link>&#32;=&#32;{&amp;<link linkend="__main_8h_1a1e4f6826343fcd16576ce3c411fb2287">chargeFlag</link>,&#32;&amp;<link linkend="__main_8h_1a5613c4060f829f65acaac2bc064ae063">chargerStatusFlag</link>,&#32;&amp;<link linkend="__main_8h_1ab11fffe9a473928798422de66fcde502">chargerVoltage</link>,&#32;&amp;<link linkend="__main_8h_1a8b27b4284d9d4039618e5da068c2bc7f">chargerCurrent</link>,&#32;&amp;<link linkend="__main_8h_1a85ede348554a838fb67a3ceb3313be5b">chargerTemp</link>};
<anchor xml:id="__main_8ino_source_1l00225"/>00225 &#32;&#32;<link linkend="__main_8h_1a566a5d391bca1611a2bfd1d97a1aa24c">chargeControllerStats</link>&#32;=&#32;{&amp;<link linkend="__main_8h_1a1e5e5db4f4b03ea34fcc2aaf5a334f2a">evccEnable</link>,&#32;&amp;<link linkend="__main_8h_1a10823f3996ecbd5481190d44baa7fd8e">evccVoltage</link>,&#32;&amp;<link linkend="__main_8h_1a283f91fe8cbd45a92dda13dd793bbbe0">evccCurrent</link>};
<anchor xml:id="__main_8ino_source_1l00226"/>00226 &#32;&#32;<link linkend="__main_8h_1ab1d006bdd632ad57598689186c8ce63a">canTaskData</link>&#32;=&#32;{<link linkend="__main_8h_1a9eeb128a9907154869e9ffa78e065039">motorStats</link>,&#32;<link linkend="__main_8h_1abb61c6dc61d12b31aad7bdadd495b70a">motorTemps</link>,&#32;<link linkend="__main_8h_1ae0522609134711f92c96ffa8ed05e582">bmsStatus</link>,&#32;<link linkend="__main_8h_1a18571448b101f12a60457d717dc4f953">thermistorTemps</link>,&#32;<link linkend="__main_8h_1afca6798677cebeeb7599ea00e1e243dd">cellVoltages</link>,&#32;<link linkend="__main_8h_1aa249f1d073086c27682168bbd7dc77ee">chargerStats</link>,&#32;<link linkend="__main_8h_1a566a5d391bca1611a2bfd1d97a1aa24c">chargeControllerStats</link>,&#32;&amp;<link linkend="__main_8h_1ad2b91d0118e98c42f7d552fd5d3056ed">seriesVoltage</link>};
<anchor xml:id="__main_8ino_source_1l00227"/>00227 }
<anchor xml:id="__main_8ino_source_1l00228"/>00228 
<anchor xml:id="__main_8ino_source_1l00229"/><link linkend="__main_8h_1a32469c898d757b2b30c00d0546f91802">00229</link> <emphasis role="keywordtype">void</emphasis>&#32;<link linkend="__main_8ino_1a32469c898d757b2b30c00d0546f91802">initializePreChargeStruct</link>()&#32;{
<anchor xml:id="__main_8ino_source_1l00230"/>00230 &#32;&#32;<link linkend="__main_8h_1a695dccac97a0f45cf570237e981b2b5d">preChargeData</link>&#32;=&#32;{<link linkend="__main_8h_1ae0522609134711f92c96ffa8ed05e582">bmsStatus</link>,&#32;<link linkend="__main_8h_1abb61c6dc61d12b31aad7bdadd495b70a">motorTemps</link>,&#32;<link linkend="__main_8h_1afca6798677cebeeb7599ea00e1e243dd">cellVoltages</link>,&#32;&amp;<link linkend="__main_8h_1aca95a5d67296e1cf7fd5d05296cefc5a">motorControllerBatteryVoltage</link>,&#32;&amp;<link linkend="__main_8h_1a6cb6d63c8afdc45f4ef149e6d3750a1c">angle_X</link>,&#32;&amp;<link linkend="__main_8h_1a89aa0714a95ede6f4c623dbeb38ff019">angle_Y</link>,
<anchor xml:id="__main_8ino_source_1l00231"/>00231 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&amp;<link linkend="__main_8h_1a5ac66e09e5f95b02b3a99a4a2a33f0aa">Rate_Roll</link>,&#32;&amp;<link linkend="__main_8h_1ae4de7890b46aeb807d61f0b71efc9ffe">Rate_Pitch</link>,&#32;&amp;<link linkend="__main_8h_1a537fbd46985b9026ec7d6d0360d1d4d0">Rate_Yaw</link>,&#32;&amp;<link linkend="__main_8h_1a1fde90bfdfb774d5f83e5fea79c17caf">Rate_CalibrationRoll</link>,&#32;&amp;<link linkend="__main_8h_1a474d53e2608e3f1b00990ca9a7ccc64a">Rate_CalibrationPitch</link>,&#32;&amp;<link linkend="__main_8h_1af1c993c5e41ee4d2e881139640989c1a">Rate_CalibrationYaw</link>,
<anchor xml:id="__main_8ino_source_1l00232"/>00232 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&amp;<link linkend="__main_8h_1a94bbee6853ba61e7fa11539e15174888">Rate_CalibrationNumber</link>,&#32;&amp;<link linkend="__main_8h_1a93a21521d3b3e91006f1957dabab890b">Acc_X</link>,&#32;&amp;<link linkend="__main_8h_1a3b4304cff5611528af473a1dfb86c345">Acc_Y</link>,&#32;&amp;<link linkend="__main_8h_1a68e2313572725be66b8d99950942dfb4">Acc_Z</link>,&#32;&amp;<link linkend="__main_8h_1a6514f0d80926dc8e4aea4c92bd86c9eb">Angle_Roll</link>,&#32;&amp;<link linkend="__main_8h_1acbed8fcd71fbc60a2452c5e5e9433903">Angle_Pitch</link>,&#32;&amp;<link linkend="__main_8h_1ac2f400fd7d3933dbf70df179a012817a">Kalman_AngleRoll</link>,
<anchor xml:id="__main_8ino_source_1l00233"/>00233 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&amp;<link linkend="__main_8h_1a2896dd40967cce4e4f8b65e93cc2fb9d">Kalman_UncertaintyAngleRoll</link>,&#32;&amp;<link linkend="__main_8h_1afb2a04d0a4be86d47607dea17db62631">Kalman_AnglePitch</link>,&#32;&amp;<link linkend="__main_8h_1ae5ea9a8add204eed975816b032f4db3b">Kalman_UncertaintyAnglePitch</link>,&#32;<link linkend="__main_8h_1a077d47652e49b1a9d682fd58ae94ba46">Kalman_1DOutput</link>
<anchor xml:id="__main_8ino_source_1l00234"/>00234 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;};
<anchor xml:id="__main_8ino_source_1l00235"/>00235 }
<anchor xml:id="__main_8ino_source_1l00236"/>00236 
<anchor xml:id="__main_8ino_source_1l00237"/><link linkend="__main_8h_1aafd615bc53c2f27720d792a6a2968209">00237</link> <emphasis role="keywordtype">bool</emphasis>&#32;<link linkend="__main_8ino_1aafd615bc53c2f27720d792a6a2968209">get_SPI_control</link>(<emphasis role="keywordtype">unsigned</emphasis>&#32;<emphasis role="keywordtype">int</emphasis>&#32;<link linkend="__main_8h_1a548fbf99c23fe3ef17f2e1a7b0992070">ms</link>)&#32;{
<anchor xml:id="__main_8ino_source_1l00238"/>00238 &#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;<link linkend="_semphr_8h_1af116e436d2a5ae5bd72dbade2b5ea930">xSemaphoreTake</link>(<link linkend="__main_8h_1a76c0525d646735793add25b18043e600">spi_mutex</link>,&#32;<link linkend="__main_8h_1a548fbf99c23fe3ef17f2e1a7b0992070">ms</link>);
<anchor xml:id="__main_8ino_source_1l00239"/>00239 }
<anchor xml:id="__main_8ino_source_1l00240"/>00240 
<anchor xml:id="__main_8ino_source_1l00241"/><link linkend="__main_8h_1a966fda2bc617e020cb78f814bb5514c1">00241</link> <emphasis role="keywordtype">void</emphasis>&#32;<link linkend="__main_8ino_1a966fda2bc617e020cb78f814bb5514c1">release_SPI_control</link>(<emphasis role="keywordtype">void</emphasis>)&#32;{
<anchor xml:id="__main_8ino_source_1l00242"/>00242 &#32;&#32;<link linkend="_semphr_8h_1aae55761cabfa9bf85c8f4430f78c0953">xSemaphoreGive</link>(<link linkend="__main_8h_1a76c0525d646735793add25b18043e600">spi_mutex</link>);
<anchor xml:id="__main_8ino_source_1l00243"/>00243 }
<anchor xml:id="__main_8ino_source_1l00244"/>00244 
<anchor xml:id="__main_8ino_source_1l00245"/><link linkend="__main_8h_1a3e0781915a9e0f2045e892efe59f9fdc">00245</link> time_t&#32;<link linkend="__main_8ino_1a3e0781915a9e0f2045e892efe59f9fdc">getTeensy3Time</link>()
<anchor xml:id="__main_8ino_source_1l00246"/>00246 {
<anchor xml:id="__main_8ino_source_1l00247"/>00247 &#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;Teensy3Clock.get();
<anchor xml:id="__main_8ino_source_1l00248"/>00248 }
<anchor xml:id="__main_8ino_source_1l00249"/>00249 
<anchor xml:id="__main_8ino_source_1l00250"/><link linkend="__main_8h_1a0d7297755c0775a9b0e4f7eeeafd7c7e">00250</link> <emphasis role="keywordtype">void</emphasis>&#32;<link linkend="__main_8ino_1a0d7297755c0775a9b0e4f7eeeafd7c7e">idleTask</link>(<emphasis role="keywordtype">void</emphasis>&#32;*taskData)&#32;{
<anchor xml:id="__main_8ino_source_1l00251"/>00251 &#32;&#32;<emphasis role="keywordflow">while</emphasis>&#32;(1)&#32;{
<anchor xml:id="__main_8ino_source_1l00252"/>00252 &#32;&#32;&#32;&#32;<link linkend="_task_8h_1aa154068cecd7f31446a7a84af44ab1a3">vTaskDelay</link>((50&#32;*&#32;<link linkend="__free_r_t_o_s_config__default_8h_1a2f0258dd1e3b877e5bc013be54c2db6a">configTICK_RATE_HZ</link>)&#32;/&#32;1000);
<anchor xml:id="__main_8ino_source_1l00253"/>00253 &#32;&#32;}
<anchor xml:id="__main_8ino_source_1l00254"/>00254 }
<anchor xml:id="__main_8ino_source_1l00255"/>00255 
<anchor xml:id="__main_8ino_source_1l00256"/><link linkend="__main_8h_1afe461d27b9c48d5921c00d521181f12f">00256</link> <emphasis role="keywordtype">void</emphasis>&#32;<link linkend="__main_8ino_1afe461d27b9c48d5921c00d521181f12f">loop</link>()&#32;{
<anchor xml:id="__main_8ino_source_1l00257"/>00257 }
</programlisting></section>
