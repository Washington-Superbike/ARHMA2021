<?xml version='1.0' encoding='UTF-8' standalone='no'?>
<section xmlns="http://docbook.org/ns/docbook" version="5.0" xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="__precharge_8h_source" xml:lang="en-US">
<title>Precharge.h</title>
Go to the documentation of this file.<programlisting linenumbering="unnumbered"><anchor xml:id="__precharge_8h_source_1l00001"/>00001 
<anchor xml:id="__precharge_8h_source_1l00026"/>00026 <emphasis role="preprocessor">#ifndef&#32;_PRECHARGE_H_</emphasis>
<anchor xml:id="__precharge_8h_source_1l00027"/>00027 <emphasis role="preprocessor">#define&#32;_PRECHARGE_H_</emphasis>
<anchor xml:id="__precharge_8h_source_1l00028"/>00028 
<anchor xml:id="__precharge_8h_source_1l00029"/>00029 <emphasis role="preprocessor">#include&#32;&quot;<link linkend="__free_r_t_o_s___t_e_e_n_s_y4_8h">FreeRTOS_TEENSY4.h</link>&quot;</emphasis>
<anchor xml:id="__precharge_8h_source_1l00030"/>00030 
<anchor xml:id="__precharge_8h_source_1l00031"/><link linkend="__precharge_8h_1a0ea5dd53294d533feaeeb8731cb9739a">00031</link> <emphasis role="preprocessor">#define&#32;PRECHARGE_TASK_STACK_SIZE&#32;configMINIMAL_STACK_SIZE&#32;+&#32;4096</emphasis>
<anchor xml:id="__precharge_8h_source_1l00032"/>00032 
<anchor xml:id="__precharge_8h_source_1l00033"/><link linkend="__precharge_8h_1ae1099ac76283225ff2bbbbdc0819ba4e">00033</link> <emphasis role="preprocessor">#define&#32;CONTACTOR&#32;16&#32;</emphasis><emphasis role="comment">//digital&#32;pin&#32;for&#32;contactor&#32;control&#32;(closing&#32;or&#32;opening)</emphasis>
<anchor xml:id="__precharge_8h_source_1l00034"/><link linkend="__precharge_8h_1a093dd273c900bae9cba2b32149e30eaa">00034</link> <emphasis role="preprocessor">#define&#32;PRECHARGE&#32;17&#32;</emphasis><emphasis role="comment">//digital&#32;pin&#32;for&#32;relay&#32;in&#32;series&#32;with&#32;precharge&#32;resistor</emphasis>
<anchor xml:id="__precharge_8h_source_1l00035"/><link linkend="__precharge_8h_1a4e1dc017df18faad4234012c3e88d2f6">00035</link> <emphasis role="preprocessor">#define&#32;HIGH_VOLTAGE_TOGGLE&#32;15&#32;&#32;&#32;</emphasis><emphasis role="comment">//&#32;digital&#32;pin&#32;for&#32;starting&#32;precharge,&#32;exit&#32;precharging,&#32;exit&#32;done-precharging</emphasis>
<anchor xml:id="__precharge_8h_source_1l00036"/><link linkend="__precharge_8h_1a6f82f95bb8a6ffac8f6998ff4e5e16ec">00036</link> <emphasis role="preprocessor">#define&#32;CLOSE_CONTACTOR_BUTTON&#32;14&#32;</emphasis><emphasis role="comment">//&#32;digital&#32;pin&#32;for&#32;closing&#32;the&#32;contactor&#32;(usable&#32;after&#32;precharging)</emphasis>
<anchor xml:id="__precharge_8h_source_1l00037"/><link linkend="__precharge_8h_1a0985e25d7f0cd7e7101c2f20c1cf8e02">00037</link> <emphasis role="preprocessor">#define&#32;CONTACTOR_PRECHARGED_LED&#32;18&#32;</emphasis><emphasis role="comment">//&#32;digital&#32;pin&#32;for&#32;LED&#32;that&#32;illuminates&#32;after&#32;precharge&#32;complete</emphasis>
<anchor xml:id="__precharge_8h_source_1l00038"/><link linkend="__precharge_8h_1a606b28f262c8b6842a36e2f68cfc327a">00038</link> <emphasis role="preprocessor">#define&#32;CONTACTOR_CLOSED_LED&#32;19&#32;</emphasis><emphasis role="comment">//&#32;digital&#32;pin&#32;for&#32;LED&#32;that&#32;illuminates&#32;when&#32;the&#32;contactor&#32;is&#32;closed</emphasis>
<anchor xml:id="__precharge_8h_source_1l00039"/><link linkend="__precharge_8h_1a3d7443dc1d0d423a961f907584dfd19e">00039</link> <emphasis role="preprocessor">#define&#32;NUMBER_OF_LTCS&#32;20&#32;</emphasis><emphasis role="comment">//&#32;THIS&#32;NEEDS&#32;TO&#32;BE&#32;CHANGED&#32;TO&#32;OUR&#32;ACTUAL&#32;NUMBER&#32;OF&#32;LTCs</emphasis>
<anchor xml:id="__precharge_8h_source_1l00040"/><link linkend="__precharge_8h_1a1f9513787cfe256aae379719ab26ca39">00040</link> <emphasis role="preprocessor">#define&#32;MOTORCONTROLLER_TEMP_MAX&#32;65&#32;</emphasis><emphasis role="comment">//&#32;THIS&#32;ALSO&#32;MAY&#32;NEED&#32;TO&#32;BE&#32;CHANGED</emphasis>
<anchor xml:id="__precharge_8h_source_1l00041"/><link linkend="__precharge_8h_1aa39f17be3d8f2f799f7fbd0dc01963db">00041</link> <emphasis role="preprocessor">#define&#32;MOTOR_TEMP_MAX&#32;80</emphasis>
<anchor xml:id="__precharge_8h_source_1l00042"/>00042 
<anchor xml:id="__precharge_8h_source_1l00043"/><link linkend="__precharge_8h_1a5faacefaff4b0ce77f1f8be0bf2aaf29a2303713b8a2ce365abb6b0de95c38595">00043</link> <emphasis role="keyword">enum</emphasis>&#32;<link linkend="__precharge_8h_1a5faacefaff4b0ce77f1f8be0bf2aaf29">HV_STATE</link>&#32;{<link linkend="__precharge_8h_1a5faacefaff4b0ce77f1f8be0bf2aaf29abc9f85ed087d13faf9b1c463431ee66a">HV_OFF</link>&#32;,&#32;<link linkend="__precharge_8h_1a5faacefaff4b0ce77f1f8be0bf2aaf29a2da9fa3988c31a60d94ee2a751ba32ce">HV_PRECHARGING</link>,&#32;<link linkend="__precharge_8h_1a5faacefaff4b0ce77f1f8be0bf2aaf29ab5febf14562b68ff6bdaaa86ec9b5dec">HV_ON</link>,&#32;<link linkend="__precharge_8h_1a5faacefaff4b0ce77f1f8be0bf2aaf29a2303713b8a2ce365abb6b0de95c38595">HV_ERROR</link>};
<anchor xml:id="__precharge_8h_source_1l00044"/>00044 
<anchor xml:id="__precharge_8h_source_1l00045"/><link linkend="_struct_pre_charge_task_data">00045</link> <emphasis role="keyword">typedef</emphasis>&#32;<emphasis role="keyword">struct&#32;</emphasis>{
<anchor xml:id="__precharge_8h_source_1l00046"/><link linkend="_struct_pre_charge_task_data_1a0dff65dcdc2df79dddc5bcf2ff491c2d">00046</link> &#32;&#32;<link linkend="_struct_b_m_s_status">BMSStatus</link>&#32;<link linkend="_struct_pre_charge_task_data_1a0dff65dcdc2df79dddc5bcf2ff491c2d">bmsStatus</link>;
<anchor xml:id="__precharge_8h_source_1l00047"/><link linkend="_struct_pre_charge_task_data_1a3e8e3c4386b66dbf1011082b1f8ce7aa">00047</link> &#32;&#32;<link linkend="_struct_motor_temps">MotorTemps</link>&#32;<link linkend="_struct_pre_charge_task_data_1a3e8e3c4386b66dbf1011082b1f8ce7aa">motorTemps</link>;
<anchor xml:id="__precharge_8h_source_1l00048"/><link linkend="_struct_pre_charge_task_data_1afdfc29c3040101593d7d298c7b432132">00048</link> &#32;&#32;<link linkend="_struct_cell_voltages">CellVoltages</link>&#32;<link linkend="_struct_pre_charge_task_data_1afdfc29c3040101593d7d298c7b432132">cellVoltages</link>;&#32;<emphasis role="comment">//&#32;from&#32;the&#32;main&#32;accumulator</emphasis>
<anchor xml:id="__precharge_8h_source_1l00049"/><link linkend="_struct_pre_charge_task_data_1aae4496a1b8d72f6107bdfcf81472741b">00049</link> &#32;&#32;<emphasis role="keywordtype">float</emphasis>*&#32;<link linkend="_struct_pre_charge_task_data_1aae4496a1b8d72f6107bdfcf81472741b">motorControllerBatteryVoltage</link>;
<anchor xml:id="__precharge_8h_source_1l00050"/><link linkend="_struct_pre_charge_task_data_1a53289d52f48c067285cb843ef7470c9a">00050</link> &#32;&#32;<emphasis role="keywordtype">float</emphasis>*&#32;<link linkend="_struct_pre_charge_task_data_1a53289d52f48c067285cb843ef7470c9a">angle_X</link>;
<anchor xml:id="__precharge_8h_source_1l00051"/><link linkend="_struct_pre_charge_task_data_1a7a48fc6887285d4cb55bff65fca23f36">00051</link> &#32;&#32;<emphasis role="keywordtype">float</emphasis>*&#32;<link linkend="_struct_pre_charge_task_data_1a7a48fc6887285d4cb55bff65fca23f36">angle_Y</link>;
<anchor xml:id="__precharge_8h_source_1l00052"/><link linkend="_struct_pre_charge_task_data_1a33b675970bf11d7e27edf3b542431997">00052</link> &#32;&#32;<emphasis role="keywordtype">float</emphasis>*&#32;<link linkend="_struct_pre_charge_task_data_1a33b675970bf11d7e27edf3b542431997">RateRoll</link>;
<anchor xml:id="__precharge_8h_source_1l00053"/><link linkend="_struct_pre_charge_task_data_1afc133d30f22f7a7f72ee498b3d69be82">00053</link> &#32;&#32;<emphasis role="keywordtype">float</emphasis>*&#32;<link linkend="_struct_pre_charge_task_data_1afc133d30f22f7a7f72ee498b3d69be82">RatePitch</link>;
<anchor xml:id="__precharge_8h_source_1l00054"/><link linkend="_struct_pre_charge_task_data_1aaf5cdfb5b1dd1857d4082f3a014ffb51">00054</link> &#32;&#32;<emphasis role="keywordtype">float</emphasis>*&#32;<link linkend="_struct_pre_charge_task_data_1aaf5cdfb5b1dd1857d4082f3a014ffb51">RateYaw</link>;
<anchor xml:id="__precharge_8h_source_1l00055"/>00055 
<anchor xml:id="__precharge_8h_source_1l00056"/><link linkend="_struct_pre_charge_task_data_1a4d7799e4a73f6488e3296c35f66c2e30">00056</link> &#32;&#32;<emphasis role="keywordtype">float</emphasis>*&#32;<link linkend="_struct_pre_charge_task_data_1a4d7799e4a73f6488e3296c35f66c2e30">RateCalibrationRoll</link>;
<anchor xml:id="__precharge_8h_source_1l00057"/><link linkend="_struct_pre_charge_task_data_1a80f6f899a8c9d6b3e7850f52350a414d">00057</link> &#32;&#32;<emphasis role="keywordtype">float</emphasis>*&#32;<link linkend="_struct_pre_charge_task_data_1a80f6f899a8c9d6b3e7850f52350a414d">RateCalibrationPitch</link>;
<anchor xml:id="__precharge_8h_source_1l00058"/><link linkend="_struct_pre_charge_task_data_1aa0d6bb3b938787ae1de06d67d1e3deaf">00058</link> &#32;&#32;<emphasis role="keywordtype">float</emphasis>*&#32;<link linkend="_struct_pre_charge_task_data_1aa0d6bb3b938787ae1de06d67d1e3deaf">RateCalibrationYaw</link>;
<anchor xml:id="__precharge_8h_source_1l00059"/>00059 
<anchor xml:id="__precharge_8h_source_1l00060"/><link linkend="_struct_pre_charge_task_data_1ab12a4f264d6acfdf84ce67728ecb42b2">00060</link> &#32;&#32;<emphasis role="keywordtype">int</emphasis>*&#32;<link linkend="_struct_pre_charge_task_data_1ab12a4f264d6acfdf84ce67728ecb42b2">RateCalibrationNumber</link>;
<anchor xml:id="__precharge_8h_source_1l00061"/><link linkend="_struct_pre_charge_task_data_1a3c051d79159770c924eda82743ba8d81">00061</link> &#32;&#32;<emphasis role="keywordtype">float</emphasis>*&#32;<link linkend="_struct_pre_charge_task_data_1a3c051d79159770c924eda82743ba8d81">AccX</link>;
<anchor xml:id="__precharge_8h_source_1l00062"/><link linkend="_struct_pre_charge_task_data_1a80f0e6e50839ffb0fc6d04cd3d871a3f">00062</link> &#32;&#32;<emphasis role="keywordtype">float</emphasis>*&#32;<link linkend="_struct_pre_charge_task_data_1a80f0e6e50839ffb0fc6d04cd3d871a3f">AccY</link>;
<anchor xml:id="__precharge_8h_source_1l00063"/><link linkend="_struct_pre_charge_task_data_1a3bb9585d2c3e9ee02ed1f98f706426b3">00063</link> &#32;&#32;<emphasis role="keywordtype">float</emphasis>*&#32;<link linkend="_struct_pre_charge_task_data_1a3bb9585d2c3e9ee02ed1f98f706426b3">AccZ</link>;
<anchor xml:id="__precharge_8h_source_1l00064"/><link linkend="_struct_pre_charge_task_data_1a99d4f80bc2e399c388039183debf146a">00064</link> &#32;&#32;<emphasis role="keywordtype">float</emphasis>*&#32;<link linkend="_struct_pre_charge_task_data_1a99d4f80bc2e399c388039183debf146a">AngleRoll</link>;
<anchor xml:id="__precharge_8h_source_1l00065"/><link linkend="_struct_pre_charge_task_data_1a4bb0f04e326928d80e286b279ca81003">00065</link> &#32;&#32;<emphasis role="keywordtype">float</emphasis>*&#32;<link linkend="_struct_pre_charge_task_data_1a4bb0f04e326928d80e286b279ca81003">AnglePitch</link>;
<anchor xml:id="__precharge_8h_source_1l00066"/>00066 
<anchor xml:id="__precharge_8h_source_1l00067"/><link linkend="_struct_pre_charge_task_data_1a6710c3c13016f4d3127232fce1782ad2">00067</link> &#32;&#32;<emphasis role="keywordtype">float</emphasis>*&#32;<link linkend="_struct_pre_charge_task_data_1a6710c3c13016f4d3127232fce1782ad2">KalmanAngleRoll</link>;
<anchor xml:id="__precharge_8h_source_1l00068"/><link linkend="_struct_pre_charge_task_data_1a56b12f35d375a77d39a5067b35701ec6">00068</link> &#32;&#32;<emphasis role="keywordtype">float</emphasis>*&#32;<link linkend="_struct_pre_charge_task_data_1a56b12f35d375a77d39a5067b35701ec6">KalmanUncertaintyAngleRoll</link>;
<anchor xml:id="__precharge_8h_source_1l00069"/><link linkend="_struct_pre_charge_task_data_1a21d75327dbefd085bb4e809b589e0dec">00069</link> &#32;&#32;<emphasis role="keywordtype">float</emphasis>*&#32;<link linkend="_struct_pre_charge_task_data_1a21d75327dbefd085bb4e809b589e0dec">KalmanAnglePitch</link>;
<anchor xml:id="__precharge_8h_source_1l00070"/><link linkend="_struct_pre_charge_task_data_1a87db2a0a7add2863f02e490544f937b2">00070</link> &#32;&#32;<emphasis role="keywordtype">float</emphasis>*&#32;<link linkend="_struct_pre_charge_task_data_1a87db2a0a7add2863f02e490544f937b2">KalmanUncertaintyAnglePitch</link>;
<anchor xml:id="__precharge_8h_source_1l00071"/><link linkend="_struct_pre_charge_task_data_1a4ca4aeeb66f8fa86b2b33287d78f8174">00071</link> &#32;&#32;<emphasis role="keywordtype">float</emphasis>*&#32;<link linkend="_struct_pre_charge_task_data_1a4ca4aeeb66f8fa86b2b33287d78f8174">Kalman1DOutput</link>;
<anchor xml:id="__precharge_8h_source_1l00072"/>00072 }&#32;<link linkend="_struct_pre_charge_task_data">PreChargeTaskData</link>;
<anchor xml:id="__precharge_8h_source_1l00073"/>00073 
<anchor xml:id="__precharge_8h_source_1l00074"/><link linkend="__precharge_8h_1a5c9b1f4b5a31b5d46c45310567595867">00074</link> <link linkend="__precharge_8h_1a5faacefaff4b0ce77f1f8be0bf2aaf29">HV_STATE</link>&#32;<link linkend="__precharge_8h_1a5c9b1f4b5a31b5d46c45310567595867">hv_state</link>&#32;=&#32;<link linkend="__precharge_8h_1a5faacefaff4b0ce77f1f8be0bf2aaf29abc9f85ed087d13faf9b1c463431ee66a">HV_OFF</link>;
<anchor xml:id="__precharge_8h_source_1l00075"/>00075 
<anchor xml:id="__precharge_8h_source_1l00076"/><link linkend="__precharge_8h_1a3a618d104e1f329b2aad074b706db5c9">00076</link> <emphasis role="keywordtype">void</emphasis>&#32;<link linkend="__precharge_8h_1a3a618d104e1f329b2aad074b706db5c9">preChargeTask</link>(<emphasis role="keywordtype">void</emphasis>&#32;*taskData);
<anchor xml:id="__precharge_8h_source_1l00077"/>00077 <emphasis role="keywordtype">void</emphasis>&#32;<link linkend="__precharge_8h_1ad5e3efaa785dcd1d9143ec7e5d117277">preChargeCircuitFSMTransitions</link>&#32;(<link linkend="_struct_pre_charge_task_data">PreChargeTaskData</link>&#32;<link linkend="__main_8h_1a695dccac97a0f45cf570237e981b2b5d">preChargeData</link>);
<anchor xml:id="__precharge_8h_source_1l00078"/>00078 <emphasis role="keywordtype">void</emphasis>&#32;<link linkend="__precharge_8h_1ad2376a25ab645f00587791af3c89968e">preChargeCircuitFSMStateActions</link>&#32;(<link linkend="_struct_pre_charge_task_data">PreChargeTaskData</link>&#32;<link linkend="__main_8h_1a695dccac97a0f45cf570237e981b2b5d">preChargeData</link>);
<anchor xml:id="__precharge_8h_source_1l00079"/>00079 <emphasis role="keywordtype">bool</emphasis>&#32;<link linkend="__precharge_8h_1a42b25fa6ccd2c8d82ba24c5ed4aaa7d1">isPrecharged</link>(<link linkend="_struct_pre_charge_task_data">PreChargeTaskData</link>&#32;<link linkend="__main_8h_1a695dccac97a0f45cf570237e981b2b5d">preChargeData</link>);
<anchor xml:id="__precharge_8h_source_1l00080"/>00080 <emphasis role="keywordtype">bool</emphasis>&#32;<link linkend="__precharge_8h_1a65867cb936f7ef47ffd07fbfd4a91355">isHVSafe</link>(<link linkend="_struct_pre_charge_task_data">PreChargeTaskData</link>&#32;<link linkend="__main_8h_1a695dccac97a0f45cf570237e981b2b5d">preChargeData</link>);
<anchor xml:id="__precharge_8h_source_1l00081"/>00081 <emphasis role="keywordtype">bool</emphasis>&#32;<link linkend="__precharge_8h_1a6798f4bd0a5b6353886f894b38b32473">check_HV_TOGGLE</link>();
<anchor xml:id="__precharge_8h_source_1l00082"/>00082 <emphasis role="keywordtype">char</emphasis>*&#32;<link linkend="__precharge_8h_1a0a3e1d4e80c1320d3308a0e0bb10ac87">state_name</link>(<link linkend="__precharge_8h_1a5faacefaff4b0ce77f1f8be0bf2aaf29">HV_STATE</link>&#32;state);
<anchor xml:id="__precharge_8h_source_1l00083"/>00083 <emphasis role="comment">//&#32;I2C&#32;Accelerometer/Gyroscope&#32;access&#32;methods</emphasis>
<anchor xml:id="__precharge_8h_source_1l00084"/>00084 <emphasis role="keywordtype">void</emphasis>&#32;<link linkend="__precharge_8h_1a5782bd590f95fb2269eb43a3d70c18f4">setupI2C</link>(<link linkend="_struct_pre_charge_task_data">PreChargeTaskData</link>&#32;<link linkend="__main_8h_1a695dccac97a0f45cf570237e981b2b5d">preChargeData</link>);
<anchor xml:id="__precharge_8h_source_1l00085"/>00085 <emphasis role="keywordtype">void</emphasis>&#32;<link linkend="__precharge_8h_1ad8511ef84de5112bd6beb8e3ac5fff67">gyro_signals</link>(<link linkend="_struct_pre_charge_task_data">PreChargeTaskData</link>&#32;<link linkend="__main_8h_1a695dccac97a0f45cf570237e981b2b5d">preChargeData</link>);
<anchor xml:id="__precharge_8h_source_1l00086"/>00086 <emphasis role="keywordtype">void</emphasis>&#32;<link linkend="__precharge_8h_1a87184d718be6821c71e697fc1fd98d3b">updateGyroData</link>(<link linkend="_struct_pre_charge_task_data">PreChargeTaskData</link>&#32;<link linkend="__main_8h_1a695dccac97a0f45cf570237e981b2b5d">preChargeData</link>);
<anchor xml:id="__precharge_8h_source_1l00087"/>00087 <emphasis role="keywordtype">void</emphasis>&#32;<link linkend="__precharge_8h_1ade8f654468b951602d2622b34902944f">kalman_1d</link>(<emphasis role="keywordtype">float</emphasis>&#32;KalmanState,&#32;<emphasis role="keywordtype">float</emphasis>&#32;KalmanUncertainty,&#32;<emphasis role="keywordtype">float</emphasis>&#32;KalmanInput,&#32;<emphasis role="keywordtype">float</emphasis>&#32;KalmanMeasurement,&#32;<link linkend="_struct_pre_charge_task_data">PreChargeTaskData</link>&#32;<link linkend="__main_8h_1a695dccac97a0f45cf570237e981b2b5d">preChargeData</link>);
<anchor xml:id="__precharge_8h_source_1l00088"/>00088 
<anchor xml:id="__precharge_8h_source_1l00089"/>00089 <emphasis role="preprocessor">#endif&#32;</emphasis><emphasis role="comment">//&#32;_PRECHARGE_H</emphasis>
</programlisting></section>
